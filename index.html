<!DOCTYPE html>
<html lang="en-AU">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Family Hub</title>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@300;400;600;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary: #2563eb; --primary-dark: #1e40af; --secondary: #0891b2;
      --accent: #f59e0b; --text-dark: #1f2937; --text-medium: #4b5563;
      --text-light: #6b7280; --bg-white: #ffffff; --bg-light: #f9fafb;
      --bg-lighter: #f3f4f6; --border: #e5e7eb; --border-light: #f3f4f6;
      --font-heading: 'Merriweather', serif; --font-body: 'Source Sans 3', sans-serif;
    }
    body { font-family: var(--font-body); background: var(--bg-white); color: var(--text-dark); line-height: 1.6; }
    .app-container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem 100px; }
    
    .header { background: rgba(255, 255, 255, 0.95); border-bottom: 1px solid var(--border); padding: 1.25rem 0; margin-bottom: 3rem; position: sticky; top: 0; z-index: 50; backdrop-filter: blur(8px); box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
    .header-content { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; display: flex; justify-content: center; align-items: center; }
    .logo-container { display: flex; align-items: center; justify-content: center; }
    .logo-image { height: 180px; width: auto; cursor: pointer; transition: transform 0.2s ease; }
    .logo-image:hover { transform: scale(1.02); }
    
    .quick-nav { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin-bottom: 2.5rem; }
    .quick-nav-item { background: var(--bg-white); border: 1px solid var(--border); border-radius: 8px; padding: 1.5rem 1rem; text-align: center; cursor: pointer; transition: all 0.2s ease; }
    .quick-nav-item:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1); border-color: var(--primary); }
    .quick-nav-icon { width: 32px; height: 32px; stroke: var(--primary); margin: 0 auto 0.75rem; }
    .quick-nav-label { font-weight: 600; font-size: 0.9rem; }
    
    .page { display: none; }
    .page.active { display: block; animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .page-header { margin-bottom: 2.5rem; padding-bottom: 1.5rem; border-bottom: 2px solid var(--border-light); }
    .page-title { font-family: var(--font-heading); font-size: 2.25rem; font-weight: 700; color: var(--text-dark); margin-bottom: 0.5rem; }
    .page-subtitle { color: var(--text-medium); font-size: 1.1rem; }
    
    .card { background: var(--bg-white); border: 1px solid var(--border); border-radius: 8px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); }
    .card:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-light); }
    .card-title { font-family: var(--font-heading); font-size: 1.5rem; font-weight: 700; }
    
    .countdown-calendar-section { display: grid; grid-template-columns: 1fr 1.5fr; gap: 2rem; margin-bottom: 2.5rem; }
    
    .countdown-card { background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 8px; padding: 0; overflow: hidden; border: 1px solid var(--border); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
    .countdown-image { width: 100%; height: 180px; background: url('https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=800') center/cover; position: relative; }
    .countdown-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(to bottom, transparent, rgba(37, 99, 235, 0.8)); display: flex; align-items: flex-end; padding: 1.5rem; }
    .countdown-destination { color: white; font-size: 1.5rem; font-weight: 700; font-family: var(--font-heading); }
    .countdown-body { padding: 2rem; text-align: center; color: white; }
    .countdown-title { font-size: 0.95rem; text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 1rem; opacity: 0.9; }
    .countdown-value { font-size: 3.5rem; font-weight: 700; font-family: var(--font-heading); margin-bottom: 0.5rem; }
    .countdown-label { font-size: 1rem; opacity: 0.9; }
    
    .mini-calendar-card { background: var(--bg-white); border: 1px solid var(--border); border-radius: 8px; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); }
    .mini-calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.25rem; }
    .mini-calendar-title { font-family: var(--font-heading); font-size: 1.25rem; font-weight: 700; }
    .mini-calendar-nav { display: flex; gap: 0.5rem; }
    .mini-calendar-btn { background: none; border: 1px solid var(--border); padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; color: var(--text-medium); transition: all 0.2s ease; }
    .mini-calendar-btn:hover { background: var(--bg-light); border-color: var(--primary); color: var(--primary); }
    .mini-calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.35rem; }
    .mini-calendar-day-header { text-align: center; padding: 0.5rem 0.25rem; font-weight: 600; font-size: 0.75rem; color: var(--text-medium); }
    .mini-calendar-day { aspect-ratio: 1; background: var(--bg-light); border: 1px solid var(--border-light); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.85rem; cursor: pointer; transition: all 0.2s ease; font-weight: 500; position: relative; }
    .mini-calendar-day:hover { background: var(--bg-lighter); border-color: var(--primary); }
    .mini-calendar-day.today { background: var(--primary); color: white; font-weight: 700; border-color: var(--primary); }
    .mini-calendar-day.has-event::after { content: '‚Ä¢'; position: absolute; bottom: 2px; color: var(--accent); font-size: 1.2rem; }
    
    .upcoming-event { background: var(--bg-light); border-left: 4px solid var(--primary); padding: 0.75rem; margin-bottom: 0.5rem; border-radius: 4px; cursor: pointer; }
    .upcoming-event:hover { background: var(--bg-lighter); }
    .upcoming-event.sport { border-left-color: #10b981; }
    .upcoming-event.school { border-left-color: #8b5cf6; }
    .upcoming-event.health { border-left-color: #ef4444; }
    .upcoming-event.travel { border-left-color: #f59e0b; }
    .upcoming-event.family { border-left-color: #2563eb; }
    .event-date { font-size: 0.75rem; font-weight: 700; color: var(--text-medium); text-transform: uppercase; }
    .event-time { font-size: 0.8rem; color: var(--primary); font-weight: 600; margin-top: 0.25rem; }
    .event-title { font-weight: 600; margin-top: 0.25rem; }
    
    .standings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
    .standing-card { background: var(--bg-light); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
    .standing-header { background: var(--primary); color: white; padding: 1rem 1.25rem; font-weight: 600; }
    .standing-body { padding: 1rem 1.25rem; }
    .standing-item { display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid var(--border-light); }
    .standing-item:last-child { border-bottom: none; }
    .team-name { font-weight: 600; }
    .team-record { color: var(--text-medium); font-size: 0.9rem; font-weight: 600; }
    .next-game { background: var(--bg-lighter); padding: 1rem 1.25rem; border-top: 1px solid var(--border); font-size: 0.9rem; }
    .next-game-label { font-weight: 600; margin-bottom: 0.25rem; }
    .next-game-detail { color: var(--text-medium); }
    
    .map-card { background: var(--bg-white); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); margin-bottom: 2rem; }
    .map-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--border-light); background: var(--bg-light); }
    .map-header h3 { font-family: var(--font-heading); font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem; }
    .map-header p { font-size: 0.9rem; color: var(--text-medium); }
    #worldMap { height: 450px; width: 100%; }
    
    .photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem; }
    .photo-item { aspect-ratio: 1; border-radius: 6px; background: var(--bg-light); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; color: var(--text-light); font-size: 2rem; cursor: pointer; transition: all 0.2s ease; }
    .photo-item:hover { transform: scale(1.02); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
    
    /* Enhanced Calendar with Event Titles */
    .calendar-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-light); flex-wrap: wrap; gap: 1rem; }
    .calendar-month { font-family: var(--font-heading); font-size: 1.5rem; font-weight: 700; }
    .calendar-actions { display: flex; gap: 0.5rem; flex-wrap: wrap; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; }
    .calendar-day-header { text-align: center; padding: 0.75rem 0.5rem; font-weight: 600; font-size: 0.85rem; color: var(--text-medium); text-transform: uppercase; background: var(--bg-light); border-radius: 4px; }
    .calendar-day { min-height: 120px; background: var(--bg-light); border: 1px solid var(--border-light); border-radius: 6px; padding: 0.5rem; cursor: pointer; transition: all 0.2s ease; display: flex; flex-direction: column; }
    .calendar-day:hover { background: var(--bg-lighter); border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .calendar-day.today { border: 2px solid var(--primary); background: rgba(37, 99, 235, 0.05); }
    .calendar-day.has-event { border-left: 4px solid var(--accent); }
    .calendar-day-number { font-weight: 700; font-size: 0.95rem; margin-bottom: 0.5rem; color: var(--text-dark); }
    .calendar-day.today .calendar-day-number { color: var(--primary); }
    .calendar-events { display: flex; flex-direction: column; gap: 0.25rem; overflow-y: auto; flex: 1; }
    .calendar-event { background: white; border: 1px solid var(--border); border-radius: 4px; padding: 0.35rem 0.5rem; font-size: 0.75rem; font-weight: 600; color: var(--text-dark); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; transition: all 0.2s ease; }
    .calendar-event:hover { background: var(--primary); color: white; transform: translateX(2px); }
    .calendar-event.sport { border-left: 3px solid #10b981; }
    .calendar-event.school { border-left: 3px solid #8b5cf6; }
    .calendar-event.health { border-left: 3px solid #ef4444; }
    .calendar-event.travel { border-left: 3px solid #f59e0b; }
    .calendar-event.recurring { font-style: italic; }
    .calendar-event-time { color: var(--text-medium); font-size: 0.7rem; font-weight: 500; }
    
    .event-list { display: flex; flex-direction: column; gap: 1rem; margin-top: 2rem; }
    .event-item { background: var(--bg-light); border: 1px solid var(--border); border-radius: 6px; padding: 1.25rem; transition: all 0.2s ease; cursor: pointer; }
    .event-item:hover { background: var(--bg-lighter); border-color: var(--primary); }
    .event-item-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem; }
    .event-item-title { font-weight: 700; font-size: 1.1rem; color: var(--text-dark); }
    .event-item-time { font-size: 0.9rem; color: var(--text-medium); font-weight: 600; }
    .event-item-details { color: var(--text-medium); font-size: 0.95rem; margin-bottom: 0.75rem; }
    .event-item-meta { display: flex; gap: 1rem; flex-wrap: wrap; }
    .event-badge { display: inline-flex; align-items: center; gap: 0.35rem; padding: 0.25rem 0.75rem; background: var(--bg-white); border: 1px solid var(--border); border-radius: 12px; font-size: 0.8rem; color: var(--text-medium); }
    .event-badge.recurring { background: var(--primary); color: white; border-color: var(--primary); }
    .event-attachments { display: flex; gap: 0.5rem; margin-top: 0.75rem; flex-wrap: wrap; }
    .event-attachment { display: inline-flex; align-items: center; gap: 0.35rem; padding: 0.35rem 0.75rem; background: white; border: 1px solid var(--border); border-radius: 4px; font-size: 0.85rem; text-decoration: none; color: var(--primary); transition: all 0.2s ease; }
    .event-attachment:hover { background: var(--bg-light); border-color: var(--primary); }
    .attachment-icon { width: 14px; height: 14px; }
    
    /* Sync Status */
    .sync-status { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: var(--bg-light); border: 1px solid var(--border); border-radius: 6px; font-size: 0.85rem; }
    .sync-status.synced { border-color: #10b981; background: rgba(16, 185, 129, 0.1); color: #10b981; }
    .sync-icon { width: 16px; height: 16px; }
    
    .timeline { position: relative; padding-left: 2.5rem; }
    .timeline::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 2px; background: var(--border); }
    .timeline-item { position: relative; margin-bottom: 2rem; }
    .timeline-item::before { content: ''; position: absolute; left: -2.5rem; top: 0.25rem; width: 14px; height: 14px; background: var(--primary); border-radius: 50%; border: 3px solid var(--bg-white); box-shadow: 0 0 0 2px var(--primary); }
    .timeline-date { font-size: 0.9rem; color: var(--primary); font-weight: 700; margin-bottom: 0.5rem; text-transform: uppercase; }
    .timeline-content { background: var(--bg-light); padding: 1.25rem; border-radius: 6px; border: 1px solid var(--border-light); }
    .timeline-title { font-weight: 700; margin-bottom: 0.5rem; }
    .timeline-text { color: var(--text-medium); font-size: 0.95rem; }
    .timeline-source { display: inline-block; margin-top: 0.5rem; padding: 0.25rem 0.75rem; background: var(--bg-white); border: 1px solid var(--border); border-radius: 4px; font-size: 0.8rem; color: var(--text-medium); }
    
    .trips-layout { display: grid; grid-template-columns: 300px 1fr; gap: 2rem; min-height: 600px; }
    .trips-sidebar { border-right: 1px solid var(--border); padding-right: 2rem; }
    .trip-list { display: flex; flex-direction: column; gap: 0.75rem; }
    .trip-item { padding: 1rem; border: 1px solid var(--border); border-radius: 6px; cursor: pointer; background: var(--bg-white); transition: all 0.2s ease; }
    .trip-item:hover { background: var(--bg-light); border-color: var(--primary); }
    .trip-item.active { background: var(--primary); color: white; }
    .trip-item-name { font-weight: 600; margin-bottom: 0.25rem; }
    .trip-item-dates { font-size: 0.85rem; color: var(--text-medium); }
    .trip-item.active .trip-item-name, .trip-item.active .trip-item-dates { color: white; }
    .trip-detail { background: var(--bg-light); border-radius: 8px; padding: 2rem; }
    .trip-header { margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 2px solid var(--border); }
    .trip-title { font-family: var(--font-heading); font-size: 2rem; margin-bottom: 0.5rem; }
    .trip-meta { display: flex; gap: 2rem; color: var(--text-medium); flex-wrap: wrap; }
    .trip-tabs { display: flex; gap: 0.5rem; margin-bottom: 2rem; border-bottom: 2px solid var(--border-light); }
    .trip-tab { padding: 0.75rem 1.5rem; background: none; border: none; border-bottom: 2px solid transparent; margin-bottom: -2px; color: var(--text-medium); cursor: pointer; font-family: var(--font-body); font-weight: 600; transition: all 0.2s ease; }
    .trip-tab:hover { color: var(--primary); }
    .trip-tab.active { color: var(--primary); border-bottom-color: var(--primary); }
    .trip-tab-content { display: none; }
    .trip-tab-content.active { display: block; }
    .itinerary-day { background: white; border: 1px solid var(--border); border-radius: 6px; padding: 1.25rem; margin-bottom: 1rem; }
    .itinerary-day-header { display: flex; justify-content: space-between; margin-bottom: 1rem; }
    .itinerary-day-title { font-weight: 700; }
    .itinerary-activities { display: flex; flex-direction: column; gap: 0.75rem; }
    .activity-item { display: flex; gap: 1rem; padding: 0.75rem; background: var(--bg-light); border-radius: 4px; }
    .activity-time { font-weight: 600; color: var(--primary); min-width: 70px; font-size: 0.85rem; }
    .activity-name { font-weight: 600; margin-bottom: 0.25rem; }
    .activity-description { font-size: 0.9rem; color: var(--text-medium); }
    .documents-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; }
    .document-item { background: white; border: 1px solid var(--border); border-radius: 6px; padding: 1rem; text-align: center; cursor: pointer; transition: all 0.2s ease; }
    .document-item:hover { border-color: var(--primary); background: var(--bg-light); }
    .document-icon { width: 48px; height: 48px; margin: 0 auto 0.75rem; stroke: var(--primary); }
    .document-name { font-weight: 600; font-size: 0.9rem; margin-bottom: 0.25rem; }
    .document-size { font-size: 0.8rem; color: var(--text-medium); }
    
    .sport-entries { display: grid; gap: 1.5rem; }
    .sport-entry { background: var(--bg-white); border: 1px solid var(--border); border-radius: 8px; padding: 1.5rem; }
    .sport-entry-header { display: grid; grid-template-columns: 1fr auto; gap: 1rem; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-light); }
    .sport-entry-title { font-weight: 700; font-size: 1.2rem; }
    .sport-entry-athlete { color: var(--primary); font-weight: 600; }
    .sport-badge { background: var(--primary); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.85rem; font-weight: 600; }
    .sport-entry-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem; }
    .sport-detail { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; }
    .sport-detail-icon { width: 16px; height: 16px; stroke: var(--text-medium); }
    .sport-result { background: var(--bg-light); padding: 1rem; border-radius: 6px; margin-top: 1rem; }
    .sport-result-label { font-weight: 600; margin-bottom: 0.5rem; }
    .sport-links { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 1rem; }
    .sport-link { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: white; border: 1px solid var(--border); border-radius: 6px; text-decoration: none; color: var(--primary); font-size: 0.85rem; font-weight: 600; }
    .sport-link:hover { background: var(--bg-light); border-color: var(--primary); }
    
    .task-tabs { display: flex; gap: 0.5rem; margin-bottom: 2rem; border-bottom: 2px solid var(--border-light); }
    .task-tab { padding: 0.75rem 1.5rem; background: none; border: none; border-bottom: 2px solid transparent; margin-bottom: -2px; color: var(--text-medium); cursor: pointer; font-family: var(--font-body); font-weight: 600; transition: all 0.2s ease; }
    .task-tab:hover { color: var(--primary); }
    .task-tab.active { color: var(--primary); border-bottom-color: var(--primary); }
    .task-content { display: none; }
    .task-content.active { display: block; }
    .task-list { display: flex; flex-direction: column; gap: 0.75rem; }
    .task-item { display: flex; align-items: center; gap: 1rem; padding: 1rem 1.25rem; background: var(--bg-light); border: 1px solid var(--border-light); border-radius: 6px; cursor: pointer; }
    .task-checkbox { width: 20px; height: 20px; border: 2px solid var(--primary); border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-size: 0.75rem; }
    .task-item.completed .task-checkbox { background: var(--primary); }
    .task-item.completed .task-text { text-decoration: line-through; opacity: 0.6; }
    .task-text { font-weight: 500; }
    
    /* Health with Attachments */
    .health-grid { display: grid; gap: 1rem; }
    .health-record { background: var(--bg-light); padding: 1.25rem; border-radius: 6px; border-left: 4px solid var(--primary); transition: all 0.2s ease; cursor: pointer; }
    .health-record:hover { background: var(--bg-lighter); transform: translateX(4px); }
    .health-header { display: flex; justify-content: space-between; margin-bottom: 0.75rem; }
    .health-name { font-weight: 700; font-size: 1.05rem; }
    .health-date { font-size: 0.85rem; color: var(--text-medium); font-weight: 600; }
    .health-detail { color: var(--text-medium); margin-bottom: 0.75rem; }
    .health-attachments { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid var(--border-light); }
    
    .link-list { display: flex; flex-direction: column; gap: 0.75rem; }
    .link-item { display: flex; align-items: center; gap: 1rem; padding: 1.25rem 1.5rem; background: var(--bg-light); border: 1px solid var(--border); border-radius: 6px; text-decoration: none; color: var(--text-dark); font-weight: 600; transition: all 0.2s ease; }
    .link-item:hover { background: var(--bg-lighter); border-color: var(--primary); color: var(--primary); transform: translateX(4px); }
    .link-icon { width: 20px; height: 20px; stroke: var(--primary); }
    
    .btn { background: var(--primary); color: white; border: none; padding: 0.75rem 1.75rem; border-radius: 6px; font-weight: 600; cursor: pointer; font-family: var(--font-body); font-size: 1rem; transition: all 0.2s ease; }
    .btn:hover { background: var(--primary-dark); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2); }
    .btn-secondary { background: white; color: var(--primary); border: 1px solid var(--border); }
    .btn-secondary:hover { background: var(--bg-light); }
    .btn-small { padding: 0.5rem 1rem; font-size: 0.9rem; }
    .btn-icon { display: inline-flex; align-items: center; gap: 0.5rem; }
    
    .form-group { margin-bottom: 1.5rem; }
    .form-label { display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.95rem; }
    .form-input, .form-textarea, .form-select { width: 100%; background: white; border: 1px solid var(--border); border-radius: 6px; padding: 0.75rem 1rem; font-family: var(--font-body); font-size: 1rem; }
    .form-input:focus, .form-textarea:focus, .form-select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
    .form-textarea { resize: vertical; min-height: 100px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .form-checkbox-group { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--bg-light); border-radius: 6px; margin-bottom: 1rem; }
    .form-checkbox { width: 20px; height: 20px; cursor: pointer; }
    
    .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center; padding: 1rem; }
    .modal.active { display: flex; }
    .modal-content { background: white; border-radius: 8px; padding: 2rem; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-light); }
    .modal-title { font-family: var(--font-heading); font-size: 1.5rem; font-weight: 700; }
    .close-modal { background: none; border: none; color: var(--text-light); cursor: pointer; font-size: 1.5rem; padding: 0; }
    
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid var(--border); padding: 0.75rem 0; z-index: 100; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05); }
    .nav-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-around; padding: 0 1rem; }
    .nav-item { display: flex; flex-direction: column; align-items: center; gap: 0.25rem; cursor: pointer; padding: 0.5rem 0.75rem; border-radius: 6px; color: var(--text-medium); font-size: 0.75rem; font-weight: 600; min-width: 70px; transition: all 0.2s ease; }
    .nav-item:hover { color: var(--primary); background: var(--bg-light); }
    .nav-item.active { color: var(--primary); background: var(--bg-lighter); }
    .nav-icon { width: 24px; height: 24px; stroke: currentColor; stroke-width: 2; fill: none; }
    
    .leaflet-popup-content-wrapper { border-radius: 8px; }
    .leaflet-popup-content { margin: 1rem; font-family: var(--font-body); }
    .popup-title { font-weight: 700; margin-bottom: 0.5rem; }
    
    .info-box { background: rgba(37, 99, 235, 0.1); border: 1px solid var(--primary); border-radius: 6px; padding: 1rem; margin-bottom: 1.5rem; }
    .info-box-title { font-weight: 700; color: var(--primary); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
    .info-box-text { font-size: 0.9rem; color: var(--text-medium); }
    
    .photo-card { border-radius: 6px; background: var(--bg-light); border: 1px solid var(--border); overflow: hidden; cursor: pointer; transition: all 0.2s ease; }
    .photo-card:hover { transform: scale(1.02); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
    .photo-placeholder { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 2rem; background: var(--bg-lighter); }
    .photo-info { padding: 0.75rem; font-weight: 600; font-size: 0.9rem; }

    .memory-timeline { position: relative; padding-left: 2.5rem; }
    .memory-timeline::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 2px; background: var(--border); }
    .memory-item { position: relative; margin-bottom: 2rem; }
    .memory-item::before { content: ''; position: absolute; left: -2.5rem; top: 0.25rem; width: 14px; height: 14px; background: var(--primary); border-radius: 50%; border: 3px solid var(--bg-white); box-shadow: 0 0 0 2px var(--primary); }
    .memory-date { font-size: 0.9rem; color: var(--primary); font-weight: 700; margin-bottom: 0.5rem; text-transform: uppercase; }
    .memory-content { background: var(--bg-light); padding: 1.25rem; border-radius: 6px; border: 1px solid var(--border-light); }
    .memory-title { font-weight: 700; margin-bottom: 0.5rem; font-size: 1.1rem; }
    .memory-text { color: var(--text-medium); font-size: 0.95rem; line-height: 1.6; }
    .memory-photos { display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap; }
    .memory-photo { width: 60px; height: 60px; background: var(--bg-lighter); border: 1px solid var(--border); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; }

    /* Login Screen */
    .login-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-white); z-index: 2000; display: flex; align-items: center; justify-content: center; }
    .login-overlay.hidden { display: none; }
    .login-card { text-align: center; padding: 3rem 2rem; max-width: 400px; width: 100%; }
    .login-card .logo-image { height: 120px; margin-bottom: 2rem; }
    .login-title { font-family: var(--font-heading); font-size: 1.5rem; font-weight: 700; color: var(--text-dark); margin-bottom: 0.5rem; }
    .login-subtitle { color: var(--text-medium); font-size: 0.95rem; margin-bottom: 2rem; }
    .pin-input { width: 200px; text-align: center; font-size: 2rem; letter-spacing: 0.75rem; padding: 0.75rem 1rem; border: 2px solid var(--border); border-radius: 8px; font-family: var(--font-body); outline: none; transition: border-color 0.2s; }
    .pin-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
    .login-btn { margin-top: 1.5rem; width: 200px; }
    .login-error { color: #ef4444; font-size: 0.85rem; margin-top: 0.75rem; min-height: 1.25rem; }

    /* Delete & Danger Buttons */
    .btn-danger { background: #ef4444; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; font-weight: 600; cursor: pointer; font-family: var(--font-body); font-size: 0.85rem; transition: all 0.2s ease; }
    .btn-danger:hover { background: #dc2626; }
    .btn-logout { background: none; border: 1px solid var(--border); color: var(--text-medium); padding: 0.35rem 0.75rem; border-radius: 4px; font-size: 0.8rem; font-weight: 600; cursor: pointer; font-family: var(--font-body); transition: all 0.2s ease; margin-left: 1rem; }
    .btn-logout:hover { border-color: #ef4444; color: #ef4444; background: rgba(239, 68, 68, 0.05); }
    .delete-btn { background: none; border: none; color: var(--text-light); cursor: pointer; font-size: 1.1rem; padding: 0.25rem 0.5rem; border-radius: 4px; transition: all 0.2s ease; line-height: 1; }
    .delete-btn:hover { color: #ef4444; background: rgba(239, 68, 68, 0.1); }

    @media (max-width: 968px) {
      .trips-layout { grid-template-columns: 1fr; }
      .trips-sidebar { border-right: none; border-bottom: 1px solid var(--border); padding-right: 0; padding-bottom: 1.5rem; }
      .countdown-calendar-section { grid-template-columns: 1fr; }
      #worldMap { height: 350px; }
      .calendar-day { min-height: 90px; }
    }
    @media (max-width: 768px) {
      .logo-image { height: 120px; }
      .page-title { font-size: 1.75rem; }
      .quick-nav { grid-template-columns: repeat(3, 1fr); }
      .form-row { grid-template-columns: 1fr; }
      .countdown-value { font-size: 2.5rem; }
      .calendar-day { min-height: 70px; font-size: 0.7rem; }
      .calendar-event { font-size: 0.65rem; padding: 0.25rem 0.35rem; }
    }
  </style>
</head>
<body>
  <!-- Login Overlay -->
  <div id="loginOverlay" class="login-overlay">
    <div class="login-card">
      <img class="logo-image" src="Family Hub with sports and family icons.png" alt="Family Hub">
      <h2 class="login-title" id="loginTitle">Set Your PIN</h2>
      <p class="login-subtitle" id="loginSubtitle">Choose a 4-digit PIN to secure your Family Hub</p>
      <form id="loginForm" onsubmit="handleLogin(event)">
        <input type="password" id="pinInput" class="pin-input" maxlength="4" pattern="[0-9]{4}" inputmode="numeric" placeholder="----" required autocomplete="off">
        <div class="login-error" id="loginError"></div>
        <button type="submit" class="btn login-btn" id="loginBtn">Set PIN</button>
      </form>
    </div>
  </div>

  <header class="header">
    <div class="header-content">
      <div class="logo-container">
        <img class="logo-image" onclick="navigateTo('home')" src="Family Hub with sports and family icons.png" alt="Family Hub">
      </div>
      <button class="btn-logout" onclick="logout()">Logout</button>
    </div>
  </header>

  <div class="app-container">
    <!-- HOME PAGE (Same as before) -->
    <div id="page-home" class="page active">
      <div class="page-header">
        <h1 class="page-title">Welcome Home</h1>
        <p class="page-subtitle">Everything that matters, in one place</p>
      </div>

      <div class="quick-nav">
        <div class="quick-nav-item" onclick="navigateTo('calendar')">
          <svg class="quick-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
          <div class="quick-nav-label">Calendar</div>
        </div>
        <div class="quick-nav-item" onclick="navigateTo('photos')">
          <svg class="quick-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
          <div class="quick-nav-label">Photos</div>
        </div>
        <div class="quick-nav-item" onclick="navigateTo('memories')">
          <svg class="quick-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
          <div class="quick-nav-label">Memories</div>
        </div>
        <div class="quick-nav-item" onclick="navigateTo('trips')">
          <svg class="quick-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
          <div class="quick-nav-label">Trips</div>
        </div>
        <div class="quick-nav-item" onclick="navigateTo('timeline')">
          <svg class="quick-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
          <div class="quick-nav-label">Timeline</div>
        </div>
        <div class="quick-nav-item" onclick="navigateTo('tasks')">
          <svg class="quick-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
          <div class="quick-nav-label">Tasks</div>
        </div>
        <div class="quick-nav-item" onclick="navigateTo('sport')">
          <svg class="quick-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path><path d="M2 12h20"></path></svg>
          <div class="quick-nav-label">Sport</div>
        </div>
        <div class="quick-nav-item" onclick="navigateTo('health')">
          <svg class="quick-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>
          <div class="quick-nav-label">Health</div>
        </div>
        <div class="quick-nav-item" onclick="navigateTo('school')">
          <svg class="quick-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
          <div class="quick-nav-label">School</div>
        </div>
      </div>

      <!-- Countdown + Mini Calendar -->
      <div class="countdown-calendar-section">
        <div class="countdown-card">
          <div class="countdown-image">
            <div class="countdown-overlay">
              <div class="countdown-destination">Japan 2026 üáØüáµ</div>
            </div>
          </div>
          <div class="countdown-body">
            <div class="countdown-title">Countdown</div>
            <div class="countdown-value" id="daysToJapan">248</div>
            <div class="countdown-label">Days Until Departure</div>
          </div>
        </div>

        <div class="mini-calendar-card">
          <div class="mini-calendar-header">
            <h3 class="mini-calendar-title">üìÖ Next 7 Days</h3>
            <button class="mini-calendar-btn" onclick="navigateTo('calendar')">View All ‚Üí</button>
          </div>
          <div id="upcomingEventsHome"></div>
        </div>
      </div>

      <!-- Sports Standings -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Live Sports Standings</h2>
        </div>
        <div class="standings-grid">
          <div class="standing-card">
            <div class="standing-header">üèÄ NBA - OKC Thunder</div>
            <div class="standing-body">
              <div class="standing-item"><span class="team-name">1. Oklahoma City</span><span class="team-record">39-9</span></div>
              <div class="standing-item"><span class="team-name">2. Cleveland</span><span class="team-record">38-9</span></div>
              <div class="standing-item"><span class="team-name">3. Boston</span><span class="team-record">33-14</span></div>
            </div>
            <div class="next-game">
              <div class="next-game-label">Next Game</div>
              <div class="next-game-detail">31 Jan @ Boston Celtics, 8:30pm AEDT</div>
            </div>
          </div>
          <div class="standing-card">
            <div class="standing-header">‚öΩ EPL - Man United</div>
            <div class="standing-body">
              <div class="standing-item"><span class="team-name">1. Liverpool</span><span class="team-record">50 pts</span></div>
              <div class="standing-item"><span class="team-name">11. Man United</span><span class="team-record">26 pts</span></div>
              <div class="standing-item"><span class="team-name">2. Arsenal</span><span class="team-record">43 pts</span></div>
            </div>
            <div class="next-game">
              <div class="next-game-label">Next Game</div>
              <div class="next-game-detail">1 Feb vs Brighton, 6:00am AEDT</div>
            </div>
          </div>
          <div class="standing-card">
            <div class="standing-header">üèÄ NBL - JackJumpers</div>
            <div class="standing-body">
              <div class="standing-item"><span class="team-name">1. Melbourne United</span><span class="team-record">15-4</span></div>
              <div class="standing-item"><span class="team-name">3. Tasmania</span><span class="team-record">12-7</span></div>
              <div class="standing-item"><span class="team-name">2. Sydney Kings</span><span class="team-record">13-6</span></div>
            </div>
            <div class="next-game">
              <div class="next-game-label">Next Game</div>
              <div class="next-game-detail">31 Jan vs Adelaide 36ers, 7:30pm AEDT</div>
            </div>
          </div>
        </div>
      </div>

      <!-- World Map -->
      <div class="map-card">
        <div class="map-header">
          <h3>Our Travel Adventures</h3>
          <p>Past, present, and future destinations</p>
        </div>
        <div id="worldMap"></div>
      </div>

      <!-- Photos -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Recent Family Photos</h2>
          <button class="btn-secondary btn-small" onclick="navigateTo('photos')">View All</button>
        </div>
        <div class="photo-grid">
          <div class="photo-item">üì∑</div>
          <div class="photo-item">üì∑</div>
          <div class="photo-item">üì∑</div>
          <div class="photo-item">üì∑</div>
          <div class="photo-item">üì∑</div>
          <div class="photo-item">üì∑</div>
        </div>
      </div>
    </div>

    <!-- ENHANCED CALENDAR PAGE -->
    <div id="page-calendar" class="page">
      <div class="page-header">
        <h1 class="page-title">Family Calendar</h1>
        <p class="page-subtitle">Manage events with iPhone sync</p>
      </div>
      
      <!-- iCal Sync Info -->
      <div class="info-box">
        <div class="info-box-title">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
          iPhone Calendar Sync
        </div>
        <div class="info-box-text">
          Subscribe to your Family Hub calendar in iPhone Calendar app. When you update events on your phone, they'll automatically sync here. Export your calendar using the button below to subscribe in iOS Settings ‚Üí Calendar ‚Üí Accounts ‚Üí Add Account ‚Üí Other ‚Üí Add Subscribed Calendar.
        </div>
      </div>
      
      <div class="card">
        <div class="calendar-controls">
          <h2 class="calendar-month" id="currentMonth">January 2026</h2>
          <div class="calendar-actions">
            <div class="sync-status synced">
              <svg class="sync-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"></polyline><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>
              Synced with iPhone
            </div>
            <button class="btn-secondary btn-small" onclick="changeMonth(-1)">‚Üê Prev</button>
            <button class="btn-secondary btn-small" onclick="changeMonth(1)">Next ‚Üí</button>
            <button class="btn-secondary btn-small" onclick="exportCalendar()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; margin-right: 0.25rem;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
              Export .ics
            </button>
          </div>
        </div>
        <div class="calendar-grid" id="calendarGrid"></div>
        <button class="btn" style="margin-top: 1.5rem;" onclick="openModal('eventModal')">Add Event</button>
      </div>

      <!-- Upcoming Events List -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Upcoming Events</h2>
        </div>
        <div class="event-list" id="eventList">
          <!-- Events populated by JavaScript -->
        </div>
      </div>
    </div>

    <!-- HEALTH PAGE with Attachments -->
    <div id="page-health" class="page">
      <div class="page-header">
        <h1 class="page-title">Health Records</h1>
        <p class="page-subtitle">Family medical information with attachments</p>
      </div>
      <div class="card">
        <div style="margin-bottom: 2rem;">
          <label class="form-label">Filter by family member</label>
          <select class="form-select" onchange="filterHealth(this.value)">
            <option value="all">All family members</option>
            <option value="evan">Evan</option>
            <option value="finn">Finn</option>
            <option value="darcy">Darcy</option>
          </select>
        </div>
        <div class="health-grid" id="healthGrid">
          <div class="health-record" data-person="finn">
            <div class="health-header">
              <span class="health-name">Finn</span>
              <span class="health-date">15/01/2026</span>
            </div>
            <div class="health-detail">Annual sports physical - cleared for all activities</div>
            <div class="health-attachments">
              <a href="#" class="event-attachment">
                <svg class="attachment-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path></svg>
                Physical Report.pdf
              </a>
              <a href="#" class="event-attachment">
                <svg class="attachment-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path></svg>
                Clearance Form.pdf
              </a>
            </div>
          </div>
          <div class="health-record" data-person="darcy">
            <div class="health-header">
              <span class="health-name">Darcy</span>
              <span class="health-date">08/01/2026</span>
            </div>
            <div class="health-detail">Eye test - new prescription, glasses ordered</div>
            <div class="health-attachments">
              <a href="#" class="event-attachment">
                <svg class="attachment-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path></svg>
                Prescription.pdf
              </a>
              <a href="#" class="event-attachment">
                <svg class="attachment-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path></svg>
                Vision Test Results
              </a>
            </div>
          </div>
          <div class="health-record" data-person="evan">
            <div class="health-header">
              <span class="health-name">Evan</span>
              <span class="health-date">20/12/2025</span>
            </div>
            <div class="health-detail">Annual checkup - all clear, continue current fitness routine</div>
            <div class="health-attachments">
              <a href="#" class="event-attachment">
                <svg class="attachment-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path></svg>
                Blood Work Results.pdf
              </a>
            </div>
          </div>
        </div>
        <button class="btn" onclick="openModal('healthModal')" style="margin-top: 1.5rem;">Add Health Record</button>
      </div>
    </div>

    <!-- EVENT MODAL -->
    <div id="eventModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Add Event</h3>
          <button class="close-modal" onclick="closeModal('eventModal')">√ó</button>
        </div>
        <form onsubmit="addEvent(event)">
          <div class="form-group">
            <label class="form-label">Event Title</label>
            <input type="text" class="form-input" placeholder="e.g. Finn's Soccer Match" required>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Date</label>
              <input type="date" class="form-input" required>
            </div>
            <div class="form-group">
              <label class="form-label">Time</label>
              <input type="time" class="form-input">
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Location</label>
            <input type="text" class="form-input" placeholder="e.g. Glenorchy Soccer Fields">
          </div>
          
          <div class="form-checkbox-group">
            <input type="checkbox" id="recurringEvent" class="form-checkbox">
            <label for="recurringEvent" class="form-label" style="margin: 0;">üîÅ Recurring Event</label>
          </div>
          
          <div class="form-group" id="recurringOptions" style="display: none;">
            <label class="form-label">Repeat Frequency</label>
            <select class="form-select">
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="biweekly">Bi-weekly</option>
              <option value="monthly">Monthly</option>
              <option value="yearly">Yearly</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Category</label>
            <select class="form-select">
              <option value="family">üë®‚Äçüë©‚Äçüë¶ Family</option>
              <option value="sport">‚öΩ Sport</option>
              <option value="school">üìö School</option>
              <option value="health">üíä Health</option>
              <option value="travel">‚úàÔ∏è Travel</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Notes</label>
            <textarea class="form-textarea" placeholder="Additional details..."></textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">Links & Attachments</label>
            <input type="url" class="form-input" placeholder="https://example.com" style="margin-bottom: 0.5rem;">
            <input type="file" class="form-input" multiple style="padding: 0.5rem;">
            <p style="font-size: 0.85rem; color: var(--text-medium); margin-top: 0.5rem;">Add relevant links or attach documents</p>
          </div>
          
          <button type="submit" class="btn" style="width: 100%;">Save Event</button>
        </form>
      </div>
    </div>

    <!-- HEALTH RECORD MODAL -->
    <div id="healthModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Add Health Record</h3>
          <button class="close-modal" onclick="closeModal('healthModal')">√ó</button>
        </div>
        <form onsubmit="addHealthRecord(event)">
          <div class="form-group">
            <label class="form-label">Family Member</label>
            <select class="form-select" required>
              <option value="">Select person...</option>
              <option value="evan">Evan</option>
              <option value="finn">Finn</option>
              <option value="darcy">Darcy</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Date</label>
            <input type="date" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label">Record Type</label>
            <select class="form-select">
              <option value="checkup">Checkup</option>
              <option value="vaccination">Vaccination</option>
              <option value="test">Test Results</option>
              <option value="prescription">Prescription</option>
              <option value="specialist">Specialist Visit</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Details</label>
            <textarea class="form-textarea" placeholder="Record details..." required></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Attachments</label>
            <input type="file" class="form-input" multiple style="padding: 0.5rem;">
            <p style="font-size: 0.85rem; color: var(--text-medium); margin-top: 0.5rem;">Attach test results, prescriptions, or related documents</p>
          </div>
          <button type="submit" class="btn" style="width: 100%;">Save Health Record</button>
        </form>
      </div>
    </div>

    <!-- PHOTO UPLOAD MODAL -->
    <div id="photoModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Upload Photos</h3>
          <button class="close-modal" onclick="closeModal('photoModal')">√ó</button>
        </div>
        <form onsubmit="addPhoto(event)">
          <div class="form-group">
            <label class="form-label">Select Photos</label>
            <input type="file" class="form-input" accept="image/*" multiple style="padding: 0.5rem;" required>
          </div>
          <div class="form-group">
            <label class="form-label">Date</label>
            <input type="date" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label">Description (optional)</label>
            <input type="text" class="form-input" placeholder="e.g. Family Christmas 2025">
          </div>
          <button type="submit" class="btn" style="width: 100%;">Upload Photos</button>
        </form>
      </div>
    </div>

    <!-- ADD MEMORY MODAL -->
    <div id="memoryModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Add Memory</h3>
          <button class="close-modal" onclick="closeModal('memoryModal')">√ó</button>
        </div>
        <form onsubmit="addMemory(event)">
          <div class="form-group">
            <label class="form-label">Date</label>
            <input type="date" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label">Title</label>
            <input type="text" class="form-input" placeholder="e.g. Family Beach Day" required>
          </div>
          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" placeholder="Tell the story of this special moment..." required></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">Photos (optional)</label>
            <input type="file" class="form-input" accept="image/*" multiple style="padding: 0.5rem;">
          </div>
          <button type="submit" class="btn" style="width: 100%;">Save Memory</button>
        </form>
      </div>
    </div>

    <!-- PLAN NEW TRIP MODAL -->
    <div id="tripModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Plan New Trip</h3>
          <button class="close-modal" onclick="closeModal('tripModal')">√ó</button>
        </div>
        <form onsubmit="addTrip(event)">
          <div class="form-group">
            <label class="form-label">Trip Name</label>
            <input type="text" class="form-input" placeholder="e.g. Bali Family Holiday" required>
          </div>
          <div class="form-group">
            <label class="form-label">Destination</label>
            <input type="text" class="form-input" placeholder="e.g. Bali, Indonesia" required>
          </div>
          <div class="form-group">
            <label class="form-label">Start Date</label>
            <input type="date" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label">End Date</label>
            <input type="date" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label">Budget (optional)</label>
            <input type="number" class="form-input" placeholder="e.g. 5000">
          </div>
          <button type="submit" class="btn" style="width: 100%;">Create Trip</button>
        </form>
      </div>
    </div>

    <!-- ADD SPORT ENTRY MODAL -->
    <div id="sportModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Add Sport Entry</h3>
          <button class="close-modal" onclick="closeModal('sportModal')">√ó</button>
        </div>
        <form onsubmit="addSportEntry(event)">
          <div class="form-group">
            <label class="form-label">Participant</label>
            <select class="form-select" id="sportParticipant" required>
              <option value="">Select participant...</option>
              <option value="finn">Finn</option>
              <option value="darcy">Darcy</option>
              <option value="dad">Dad</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Sport</label>
            <select class="form-select" id="sportSport" required>
              <option value="">Select sport...</option>
              <option value="soccer">Soccer</option>
              <option value="futsal">Futsal</option>
              <option value="basketball">Basketball</option>
              <option value="rowing">Rowing</option>
              <option value="table-tennis">Table Tennis</option>
              <option value="golf">Golf</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Entry Type</label>
            <select class="form-select" id="sportType" onchange="toggleSportFields()" required>
              <option value="">Select type...</option>
              <option value="match">Match</option>
              <option value="training">Training Session</option>
            </select>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Start Date</label>
              <input type="date" class="form-input" id="sportStartDate" required>
            </div>
            <div class="form-group">
              <label class="form-label">End Date (optional)</label>
              <input type="date" class="form-input" id="sportEndDate">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Start Time</label>
              <input type="time" class="form-input" id="sportStartTime" required>
            </div>
            <div class="form-group">
              <label class="form-label">End Time (optional)</label>
              <input type="time" class="form-input" id="sportEndTime">
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Title</label>
            <input type="text" class="form-input" id="sportTitle" placeholder="e.g. Glenorchy Knights vs Kingborough">
          </div>
          <div class="form-group" id="matchResult" style="display: none;">
            <label class="form-label">Match Result (optional)</label>
            <input type="text" class="form-input" placeholder="e.g. 3-1 Win">
          </div>
          <div class="form-group">
            <label class="form-label">Location</label>
            <input type="text" class="form-input" id="sportLocation" placeholder="e.g. KGV Oval">
          </div>
          <div class="form-checkbox-group">
            <input type="checkbox" id="sportAddToCalendar" class="form-checkbox" checked>
            <label for="sportAddToCalendar" class="form-label" style="margin: 0;">Add to Family Calendar</label>
          </div>
          <div class="form-group">
            <label class="form-label">Notes</label>
            <textarea class="form-textarea" id="sportNotes" placeholder="Performance notes, highlights..."></textarea>
          </div>
          <button type="submit" class="btn" style="width: 100%;">Save Entry</button>
        </form>
      </div>
    </div>

    <!-- ADD TASK MODAL -->
    <div id="taskModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Add Task</h3>
          <button class="close-modal" onclick="closeModal('taskModal')">√ó</button>
        </div>
        <form onsubmit="addTask(event)">
          <div class="form-group">
            <label class="form-label">Task Category</label>
            <select class="form-select" id="taskCategory" required>
              <option value="">Select category...</option>
              <option value="family">Family</option>
              <option value="school">School</option>
              <option value="sport">Sport</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Task Description</label>
            <input type="text" class="form-input" placeholder="e.g. Buy groceries" required>
          </div>
          <div class="form-group">
            <label class="form-label">Due Date (optional)</label>
            <input type="date" class="form-input">
          </div>
          <button type="submit" class="btn" style="width: 100%;">Add Task</button>
        </form>
      </div>
    </div>

    <!-- PHOTOS PAGE - FULL VERSION -->
    <div id="page-photos" class="page">
      <div class="page-header">
        <h1 class="page-title">Family Photos</h1>
        <p class="page-subtitle">Cherished moments captured</p>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Photo Gallery</h2>
          <div style="display: flex; gap: 0.5rem;">
            <select class="form-select" style="width: auto;" onchange="filterPhotos(this.value)">
              <option value="all">All Photos</option>
              <option value="2026">2026</option>
              <option value="2025">2025</option>
            </select>
            <button class="btn btn-small" onclick="openModal('photoModal')">Upload Photos</button>
          </div>
        </div>
        <div class="photo-grid" id="photoGrid">
          <div class="photo-card" data-year="2025">
            <div class="photo-placeholder">üì∑</div>
            <div class="photo-info">Christmas 2025<br><span style="font-size: 0.75rem; opacity: 0.8;">Dec 25</span></div>
          </div>
          <div class="photo-card" data-year="2026">
            <div class="photo-placeholder">üì∑</div>
            <div class="photo-info">Finn's Match Win<br><span style="font-size: 0.75rem; opacity: 0.8;">Jan 18</span></div>
          </div>
          <div class="photo-card" data-year="2025">
            <div class="photo-placeholder">üì∑</div>
            <div class="photo-info">Family Dinner<br><span style="font-size: 0.75rem; opacity: 0.8;">Nov 20</span></div>
          </div>
          <div class="photo-card" data-year="2025">
            <div class="photo-placeholder">üì∑</div>
            <div class="photo-info">Beach Trip<br><span style="font-size: 0.75rem; opacity: 0.8;">Oct 15</span></div>
          </div>
          <div class="photo-card" data-year="2026">
            <div class="photo-placeholder">üì∑</div>
            <div class="photo-info">Birthday Party<br><span style="font-size: 0.75rem; opacity: 0.8;">Jan 5</span></div>
          </div>
          <div class="photo-card" data-year="2025">
            <div class="photo-placeholder">üì∑</div>
            <div class="photo-info">School Event<br><span style="font-size: 0.75rem; opacity: 0.8;">Dec 10</span></div>
          </div>
          <div class="photo-card" data-year="2025">
            <div class="photo-placeholder">üì∑</div>
            <div class="photo-info">Soccer Finals<br><span style="font-size: 0.75rem; opacity: 0.8;">Nov 5</span></div>
          </div>
          <div class="photo-card" data-year="2026">
            <div class="photo-placeholder">üì∑</div>
            <div class="photo-info">New Year 2026<br><span style="font-size: 0.75rem; opacity: 0.8;">Jan 1</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- MEMORIES PAGE - FULL VERSION -->
    <div id="page-memories" class="page">
      <div class="page-header">
        <h1 class="page-title">Family Memories</h1>
        <p class="page-subtitle">Special moments we treasure</p>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Timeline of Memories</h2>
          <button class="btn btn-small" onclick="openModal('memoryModal')">Add Memory</button>
        </div>
        <div class="memory-timeline" id="memoryTimeline">
          <div class="memory-item">
            <div class="memory-date">January 2026</div>
            <div class="memory-content">
              <div class="memory-title">üéâ Website Launch</div>
              <div class="memory-text">Successfully launched our Family Hub website! Now we can keep track of everything in one place. The boys are excited to see photos and track their activities.</div>
            </div>
          </div>
          <div class="memory-item">
            <div class="memory-date">December 2025</div>
            <div class="memory-content">
              <div class="memory-title">üéÑ Family Christmas</div>
              <div class="memory-text">Wonderful Christmas celebration with the whole family. Finn and Darcy loved their gifts, and we enjoyed a beautiful day together. Best Christmas yet!</div>
              <div class="memory-photos">
                <div class="memory-photo">üì∑</div>
                <div class="memory-photo">üì∑</div>
                <div class="memory-photo">üì∑</div>
                <div class="memory-photo">üì∑</div>
              </div>
            </div>
          </div>
          <div class="memory-item">
            <div class="memory-date">November 2025</div>
            <div class="memory-content">
              <div class="memory-title">‚öΩ Finn Selected for State Team</div>
              <div class="memory-text">Incredible news! Finn was selected for the Tasmania State soccer team. So proud of all his hard work and dedication. This is a huge achievement and we celebrated with the whole family.</div>
            </div>
          </div>
          <div class="memory-item">
            <div class="memory-date">October 2025</div>
            <div class="memory-content">
              <div class="memory-title">üéÆ Darcy's Gaming Tournament</div>
              <div class="memory-text">Darcy competed in his first major gaming tournament and placed in the top 10. Great achievement! He was nervous at first but performed brilliantly.</div>
              <div class="memory-photos">
                <div class="memory-photo">üì∑</div>
                <div class="memory-photo">üì∑</div>
              </div>
            </div>
          </div>
          <div class="memory-item">
            <div class="memory-date">September 2025</div>
            <div class="memory-content">
              <div class="memory-title">üèñÔ∏è Weekend at Bruny Island</div>
              <div class="memory-text">Perfect family weekend away at Bruny Island. Explored the lighthouse, tried fresh oysters, and enjoyed quality time together away from the city.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- TRIPS PAGE - FULL WANDERLUST VERSION -->
    <div id="page-trips" class="page">
      <div class="page-header">
        <h1 class="page-title">Family Trips</h1>
        <p class="page-subtitle">Adventures and getaways</p>
      </div>
      
      <div class="trips-layout">
        <div class="trips-sidebar">
          <button class="btn" style="width: 100%; margin-bottom: 1rem;" onclick="openModal('tripModal')">Plan New Trip</button>
          <div class="trip-list">
            <div class="trip-item active" onclick="showTrip('japan', event)">
              <div class="trip-item-name">üáØüáµ Japan 2026</div>
              <div class="trip-item-dates">Oct 1-13, 2026 ‚Ä¢ 13 days</div>
            </div>
            <div class="trip-item" onclick="showTrip('melbourne', event)">
              <div class="trip-item-name">üèôÔ∏è Melbourne Weekend</div>
              <div class="trip-item-dates">Mar 15-17, 2026 ‚Ä¢ 3 days</div>
            </div>
            <div class="trip-item" onclick="showTrip('sydney', event)">
              <div class="trip-item-name">üåä Sydney Trip</div>
              <div class="trip-item-dates">Nov 2025 ‚Ä¢ 4 days</div>
            </div>
          </div>
        </div>
        <div class="trip-detail">
          <div class="trip-header">
            <div>
              <h2 class="trip-title">Japan 2026</h2>
              <div style="display: flex; gap: 1.5rem; margin-top: 0.75rem; color: var(--text-medium);">
                <div>üìÖ October 1-13, 2026</div>
                <div>‚è±Ô∏è 13 days</div>
                <div>üí∞ Budget: $15,000</div>
              </div>
            </div>
          </div>
          <div class="trip-tabs">
            <button class="trip-tab active" onclick="showTripTab('itinerary', event)">Itinerary</button>
            <button class="trip-tab" onclick="showTripTab('documents', event)">Documents</button>
            <button class="trip-tab" onclick="showTripTab('budget', event)">Budget</button>
            <button class="trip-tab" onclick="showTripTab('notes', event)">Notes</button>
          </div>
          
          <!-- Itinerary Tab -->
          <div id="trip-itinerary" class="trip-tab-content active">
            <div class="itinerary-day">
              <div class="itinerary-day-header">
                <div class="itinerary-day-title">Day 1 - Arrival in Tokyo</div>
                <div style="color: var(--text-medium);">Wednesday, Oct 1</div>
              </div>
              <div class="itinerary-activities">
                <div class="activity-item">
                  <div class="activity-time">14:00</div>
                  <div>
                    <div class="activity-name">Land at Narita Airport</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">Flight QF79 from Sydney - Booking ref: ABC123</div>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-time">16:30</div>
                  <div>
                    <div class="activity-name">Check-in at Hotel</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">Shinjuku Prince Hotel - Reservation: DEF456</div>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-time">19:00</div>
                  <div>
                    <div class="activity-name">Dinner in Shinjuku</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">Explore local restaurants and izakayas</div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="itinerary-day">
              <div class="itinerary-day-header">
                <div class="itinerary-day-title">Day 2 - Tokyo DisneySea</div>
                <div style="color: var(--text-medium);">Thursday, Oct 2</div>
              </div>
              <div class="itinerary-activities">
                <div class="activity-item">
                  <div class="activity-time">08:00</div>
                  <div>
                    <div class="activity-name">Tokyo DisneySea - Full Day</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">Tickets booked - arrive early for rope drop. Focus on Mediterranean Harbor and Mysterious Island.</div>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-time">21:00</div>
                  <div>
                    <div class="activity-name">Return to Hotel</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">Train from Maihama Station</div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="itinerary-day">
              <div class="itinerary-day-header">
                <div class="itinerary-day-title">Day 3 - Tokyo Disneyland</div>
                <div style="color: var(--text-medium);">Friday, Oct 3</div>
              </div>
              <div class="itinerary-activities">
                <div class="activity-item">
                  <div class="activity-time">08:00</div>
                  <div>
                    <div class="activity-name">Tokyo Disneyland - Full Day</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">Tickets booked - priority: Space Mountain, Big Thunder Mountain, Splash Mountain</div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="itinerary-day">
              <div class="itinerary-day-header">
                <div class="itinerary-day-title">Day 4 - Tokyo Exploration</div>
                <div style="color: var(--text-medium);">Saturday, Oct 4</div>
              </div>
              <div class="itinerary-activities">
                <div class="activity-item">
                  <div class="activity-time">09:00</div>
                  <div>
                    <div class="activity-name">Senso-ji Temple</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">Historic temple in Asakusa, explore Nakamise shopping street</div>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-time">13:00</div>
                  <div>
                    <div class="activity-name">teamLab Borderless</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">Digital art museum - tickets pre-booked</div>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-time">19:00</div>
                  <div>
                    <div class="activity-name">Shibuya Crossing & Dinner</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">Experience the famous crossing, explore Shibuya area</div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="itinerary-day">
              <div class="itinerary-day-header">
                <div class="itinerary-day-title">Day 5 - Mt Fuji Day Trip</div>
                <div style="color: var(--text-medium);">Sunday, Oct 5</div>
              </div>
              <div class="itinerary-activities">
                <div class="activity-item">
                  <div class="activity-time">07:00</div>
                  <div>
                    <div class="activity-name">Depart for Mt Fuji</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">Bus tour booked - includes Lake Kawaguchi and 5th Station</div>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-time">19:00</div>
                  <div>
                    <div class="activity-name">Return to Tokyo</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">Evening free in Shinjuku</div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="itinerary-day">
              <div class="itinerary-day-header">
                <div class="itinerary-day-title">Day 6 - Travel to Osaka</div>
                <div style="color: var(--text-medium);">Monday, Oct 6</div>
              </div>
              <div class="itinerary-activities">
                <div class="activity-item">
                  <div class="activity-time">10:00</div>
                  <div>
                    <div class="activity-name">Shinkansen to Osaka</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">2.5 hour bullet train journey - JR Pass</div>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-time">15:00</div>
                  <div>
                    <div class="activity-name">Check-in Osaka Hotel</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">Hotel in Namba area - walking distance to Dotonbori</div>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-time">18:00</div>
                  <div>
                    <div class="activity-name">Dotonbori District</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">Iconic neon lights, street food, try takoyaki and okonomiyaki</div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="itinerary-day">
              <div class="itinerary-day-header">
                <div class="itinerary-day-title">Day 7 - Universal Studios Japan</div>
                <div style="color: var(--text-medium);">Tuesday, Oct 7</div>
              </div>
              <div class="itinerary-activities">
                <div class="activity-item">
                  <div class="activity-time">08:00</div>
                  <div>
                    <div class="activity-name">Universal Studios Japan - Full Day</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">Super Nintendo World, Harry Potter, express passes booked</div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="itinerary-day">
              <div class="itinerary-day-header">
                <div class="itinerary-day-title">Day 8 - Osaka & Kyoto</div>
                <div style="color: var(--text-medium);">Wednesday, Oct 8</div>
              </div>
              <div class="itinerary-activities">
                <div class="activity-item">
                  <div class="activity-time">09:00</div>
                  <div>
                    <div class="activity-name">Osaka Castle</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">Historic castle and beautiful grounds</div>
                  </div>
                </div>
                <div class="activity-item">
                  <div class="activity-time">14:00</div>
                  <div>
                    <div class="activity-name">Day Trip to Kyoto</div>
                    <div style="color: var(--text-medium); font-size: 0.9rem;">Fushimi Inari Shrine, Arashiyama Bamboo Grove</div>
                  </div>
                </div>
              </div>
            </div>
            
            <div style="text-align: center; padding: 2rem; color: var(--text-medium);">
              <p>Days 9-13: Additional itinerary details to be added...</p>
            </div>
          </div>
          
          <!-- Documents Tab -->
          <div id="trip-documents" class="trip-tab-content">
            <div style="display: grid; gap: 1rem;">
              <div style="background: white; border: 1px solid var(--border); border-radius: 6px; padding: 1.25rem; display: flex; align-items: center; gap: 1rem;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                <div style="flex: 1;">
                  <div style="font-weight: 600;">Flight Tickets - Sydney to Tokyo.pdf</div>
                  <div style="font-size: 0.85rem; color: var(--text-medium);">QF79 - Oct 1, 2026</div>
                </div>
                <button class="btn-secondary btn-small">View</button>
              </div>
              <div style="background: white; border: 1px solid var(--border); border-radius: 6px; padding: 1.25rem; display: flex; align-items: center; gap: 1rem;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                <div style="flex: 1;">
                  <div style="font-weight: 600;">Hotel Reservations.pdf</div>
                  <div style="font-size: 0.85rem; color: var(--text-medium);">All hotels confirmed</div>
                </div>
                <button class="btn-secondary btn-small">View</button>
              </div>
              <div style="background: white; border: 1px solid var(--border); border-radius: 6px; padding: 1.25rem; display: flex; align-items: center; gap: 1rem;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                <div style="flex: 1;">
                  <div style="font-weight: 600;">Disney & USJ Tickets.pdf</div>
                  <div style="font-size: 0.85rem; color: var(--text-medium);">All park tickets</div>
                </div>
                <button class="btn-secondary btn-small">View</button>
              </div>
              <div style="background: white; border: 1px solid var(--border); border-radius: 6px; padding: 1.25rem; display: flex; align-items: center; gap: 1rem;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
                <div style="flex: 1;">
                  <div style="font-weight: 600;">Travel Insurance.pdf</div>
                  <div style="font-size: 0.85rem; color: var(--text-medium);">Policy #123456</div>
                </div>
                <button class="btn-secondary btn-small">View</button>
              </div>
              <button class="btn" style="margin-top: 1rem;" onclick="alert('Upload document feature coming with backend!')">Upload Document</button>
            </div>
          </div>
          
          <!-- Budget Tab -->
          <div id="trip-budget" class="trip-tab-content">
            <div style="background: white; border: 1px solid var(--border); border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem;">
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; text-align: center;">
                <div>
                  <div style="font-size: 0.85rem; color: var(--text-medium); margin-bottom: 0.5rem;">Total Budget</div>
                  <div style="font-size: 2rem; font-weight: 700; color: var(--primary);">$15,000</div>
                </div>
                <div>
                  <div style="font-size: 0.85rem; color: var(--text-medium); margin-bottom: 0.5rem;">Spent</div>
                  <div style="font-size: 2rem; font-weight: 700; color: var(--accent);">$8,450</div>
                </div>
                <div>
                  <div style="font-size: 0.85rem; color: var(--text-medium); margin-bottom: 0.5rem;">Remaining</div>
                  <div style="font-size: 2rem; font-weight: 700; color: var(--secondary);">$6,550</div>
                </div>
              </div>
            </div>
            <div style="display: grid; gap: 0.75rem;">
              <div style="background: white; border: 1px solid var(--border); border-radius: 6px; padding: 1rem; display: grid; grid-template-columns: auto 1fr auto; gap: 1rem; align-items: center;">
                <div style="width: 40px; height: 40px; background: var(--bg-light); border-radius: 8px; display: flex; align-items: center; justify-content: center;">‚úàÔ∏è</div>
                <div>
                  <div style="font-weight: 600;">Flights</div>
                  <div style="font-size: 0.85rem; color: var(--text-medium);">Return flights for 3</div>
                </div>
                <div style="font-weight: 700; font-size: 1.1rem;">$4,500</div>
              </div>
              <div style="background: white; border: 1px solid var(--border); border-radius: 6px; padding: 1rem; display: grid; grid-template-columns: auto 1fr auto; gap: 1rem; align-items: center;">
                <div style="width: 40px; height: 40px; background: var(--bg-light); border-radius: 8px; display: flex; align-items: center; justify-content: center;">üè®</div>
                <div>
                  <div style="font-weight: 600;">Accommodation</div>
                  <div style="font-size: 0.85rem; color: var(--text-medium);">12 nights total</div>
                </div>
                <div style="font-weight: 700; font-size: 1.1rem;">$2,400</div>
              </div>
              <div style="background: white; border: 1px solid var(--border); border-radius: 6px; padding: 1rem; display: grid; grid-template-columns: auto 1fr auto; gap: 1rem; align-items: center;">
                <div style="width: 40px; height: 40px; background: var(--bg-light); border-radius: 8px; display: flex; align-items: center; justify-content: center;">üé¢</div>
                <div>
                  <div style="font-weight: 600;">Theme Parks</div>
                  <div style="font-size: 0.85rem; color: var(--text-medium);">Disney, USJ tickets</div>
                </div>
                <div style="font-weight: 700; font-size: 1.1rem;">$1,200</div>
              </div>
              <div style="background: white; border: 1px solid var(--border); border-radius: 6px; padding: 1rem; display: grid; grid-template-columns: auto 1fr auto; gap: 1rem; align-items: center;">
                <div style="width: 40px; height: 40px; background: var(--bg-light); border-radius: 8px; display: flex; align-items: center; justify-content: center;">üçú</div>
                <div>
                  <div style="font-weight: 600;">Food Budget</div>
                  <div style="font-size: 0.85rem; color: var(--text-medium);">Estimate: $100/day</div>
                </div>
                <div style="font-weight: 700; font-size: 1.1rem; color: var(--text-medium);">$1,300 (est)</div>
              </div>
              <div style="background: white; border: 1px solid var(--border); border-radius: 6px; padding: 1rem; display: grid; grid-template-columns: auto 1fr auto; gap: 1rem; align-items: center;">
                <div style="width: 40px; height: 40px; background: var(--bg-light); border-radius: 8px; display: flex; align-items: center; justify-content: center;">üöå</div>
                <div>
                  <div style="font-weight: 600;">Transport & Tours</div>
                  <div style="font-size: 0.85rem; color: var(--text-medium);">JR Pass, local transport</div>
                </div>
                <div style="font-weight: 700; font-size: 1.1rem; color: var(--text-medium);">$800 (est)</div>
              </div>
            </div>
          </div>
          
          <!-- Notes Tab -->
          <div id="trip-notes" class="trip-tab-content">
            <div style="background: white; border: 1px solid var(--border); border-radius: 8px; padding: 1.5rem;">
              <h3 style="margin-bottom: 1rem;">Trip Notes & Tips</h3>
              <div style="display: flex; flex-direction: column; gap: 1rem;">
                <div style="background: var(--bg-light); padding: 1rem; border-radius: 6px; border-left: 3px solid var(--primary);">
                  <div style="font-weight: 600; margin-bottom: 0.5rem;">üì± Wi-Fi & Communication</div>
                  <div style="color: var(--text-medium);">Pocket Wi-Fi device booked - pick up at Narita Airport. Emergency contact numbers saved in phones.</div>
                </div>
                <div style="background: var(--bg-light); padding: 1rem; border-radius: 6px; border-left: 3px solid var(--primary);">
                  <div style="font-weight: 600; margin-bottom: 0.5rem;">üéí Packing List</div>
                  <div style="color: var(--text-medium);">Comfortable walking shoes essential. Light jacket for evenings. Portable phone chargers. Small backpack for day trips.</div>
                </div>
                <div style="background: var(--bg-light); padding: 1rem; border-radius: 6px; border-left: 3px solid var(--primary);">
                  <div style="font-weight: 600; margin-bottom: 0.5rem;">üí¥ Money & Payments</div>
                  <div style="color: var(--text-medium);">Cash needed for smaller shops and restaurants. 7-Eleven ATMs accept foreign cards. IC card (Suica/Pasmo) for transport.</div>
                </div>
                <div style="background: var(--bg-light); padding: 1rem; border-radius: 6px; border-left: 3px solid var(--primary);">
                  <div style="font-weight: 600; margin-bottom: 0.5rem;">üç± Food Recommendations</div>
                  <div style="color: var(--text-medium);">Try: ramen, sushi, tempura, okonomiyaki, takoyaki, matcha desserts. Don't miss: convenience store snacks!</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- SPORT PAGE - FULL VERSION -->
    <div id="page-sport" class="page">
      <div class="page-header">
        <h1 class="page-title">Sport Tracking</h1>
        <p class="page-subtitle">Matches, training & activities</p>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Recent Matches & Training</h2>
          <button class="btn btn-small" onclick="openModal('sportModal')">Add Entry</button>
        </div>
        <div class="sport-entries" id="sportEntriesList">
          <div class="sport-entry">
            <div class="sport-entry-header">
              <div>
                <div class="sport-entry-title">State Team Training Session</div>
                <div style="color: var(--text-medium); font-size: 0.9rem;">üìÖ Sunday, Jan 26, 2026 ‚Ä¢ 10:00am</div>
              </div>
              <div class="sport-badge">‚öΩ Training</div>
            </div>
            <div style="margin: 1rem 0;">Regular Sunday morning training session with Tasmania State Team at KGV Oval. Focused on passing drills, set pieces, and small-sided games. Coach praised Finn's positioning and teamwork throughout the session.</div>
            <div class="sport-result">
              <div style="font-weight: 600; margin-bottom: 0.5rem;">üìä Performance Notes:</div>
              <div style="color: var(--text-medium);">Excellent effort and attitude. Continuing to improve ball control and spatial awareness. Working well with teammates on combination play.</div>
            </div>
          </div>
          
          <div class="sport-entry">
            <div class="sport-entry-header">
              <div>
                <div class="sport-entry-title">Glenorchy Knights vs Kingborough Lions SC</div>
                <div style="color: var(--text-medium); font-size: 0.9rem;">üìÖ Saturday, Jan 18, 2026 ‚Ä¢ 2:00pm</div>
              </div>
              <div class="sport-badge">üèÜ Match</div>
            </div>
            <div style="margin: 1rem 0;">NPL Tasmania U16 league match at KGV Oval. Finn started as attacking midfielder and played 75 minutes before being substituted. Excellent performance with goal and assist.</div>
            <div class="sport-result">
              <div style="font-weight: 600; margin-bottom: 0.75rem;">üéØ Result:</div>
              <div style="background: var(--bg-light); padding: 1rem; border-radius: 6px; display: grid; gap: 0.5rem;">
                <div style="color: var(--primary); font-weight: 700; font-size: 1.25rem;">Glenorchy Knights 3 - 1 Kingborough Lions</div>
                <div style="display: flex; gap: 2rem; margin-top: 0.5rem;">
                  <div><strong>‚öΩ Goals:</strong> 1</div>
                  <div><strong>üéØ Assists:</strong> 1</div>
                  <div><strong>‚è±Ô∏è Minutes:</strong> 75</div>
                </div>
              </div>
            </div>
            <div style="margin-top: 1rem;">
              <div style="font-weight: 600; margin-bottom: 0.5rem;">üé¨ Match Highlights:</div>
              <a href="#" style="color: var(--primary); text-decoration: none; font-size: 0.9rem;">üìπ Watch highlights video ‚Üí</a>
            </div>
          </div>
          
          <div class="sport-entry">
            <div class="sport-entry-header">
              <div>
                <div class="sport-entry-title">State Team Training Session</div>
                <div style="color: var(--text-medium); font-size: 0.9rem;">üìÖ Sunday, Jan 12, 2026 ‚Ä¢ 10:00am</div>
              </div>
              <div class="sport-badge">‚öΩ Training</div>
            </div>
            <div style="margin: 1rem 0;">First training session of 2026 with the State Team. Focus on fitness and conditioning after the break. Technical drills working on first touch and passing under pressure.</div>
            <div class="sport-result">
              <div style="font-weight: 600; margin-bottom: 0.5rem;">üìä Performance Notes:</div>
              <div style="color: var(--text-medium);">Good return to training. Fitness levels maintained over break. Ready for upcoming match schedule.</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Training Schedule -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Training Schedule</h2>
        </div>
        <div style="display: grid; gap: 0.75rem;">
          <div style="background: var(--bg-light); padding: 1rem; border-radius: 6px; border-left: 3px solid var(--primary);">
            <div style="font-weight: 600; margin-bottom: 0.25rem;">Tasmania State Team</div>
            <div style="color: var(--text-medium); font-size: 0.9rem;">Every Sunday ‚Ä¢ 10:00am-12:00pm ‚Ä¢ KGV Oval</div>
          </div>
          <div style="background: var(--bg-light); padding: 1rem; border-radius: 6px; border-left: 3px solid var(--secondary);">
            <div style="font-weight: 600; margin-bottom: 0.25rem;">Glenorchy Knights</div>
            <div style="color: var(--text-medium); font-size: 0.9rem;">Tuesday & Thursday ‚Ä¢ 5:30pm-7:00pm ‚Ä¢ Glenorchy Soccer Club</div>
          </div>
        </div>
      </div>
    </div>

    <!-- TIMELINE PAGE - FULL VERSION -->
    <div id="page-timeline" class="page">
      <div class="page-header">
        <h1 class="page-title">Family Timeline</h1>
        <p class="page-subtitle">Everything happening in our lives</p>
      </div>
      
      <div class="card">
        <div style="margin-bottom: 1.5rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
          <button class="btn-secondary btn-small" onclick="filterTimeline('all')">All</button>
          <button class="btn-secondary btn-small" onclick="filterTimeline('calendar')">üìÖ Calendar</button>
          <button class="btn-secondary btn-small" onclick="filterTimeline('sport')">‚öΩ Sport</button>
          <button class="btn-secondary btn-small" onclick="filterTimeline('memories')">‚ù§Ô∏è Memories</button>
          <button class="btn-secondary btn-small" onclick="filterTimeline('trips')">‚úàÔ∏è Trips</button>
        </div>
        <div class="timeline">
          <div class="timeline-item" data-category="system">
            <div class="timeline-date">Today, Jan 29, 2026</div>
            <div class="timeline-content">
              <div class="timeline-title">üéâ Family Hub Website Launched!</div>
              <div class="timeline-text">Successfully deployed our complete Family Hub website with all features functional. Now we can track photos, memories, trips, sport, tasks, and everything important to our family in one central place.</div>
              <span class="timeline-source">System</span>
            </div>
          </div>
          
          <div class="timeline-item" data-category="sport">
            <div class="timeline-date">Sunday, Jan 26, 2026</div>
            <div class="timeline-content">
              <div class="timeline-title">‚öΩ State Team Training</div>
              <div class="timeline-text">Finn attended Tasmania State Team training session at KGV Oval. Coach praised his positioning and teamwork.</div>
              <span class="timeline-source">Sport</span>
            </div>
          </div>
          
          <div class="timeline-item" data-category="sport">
            <div class="timeline-date">Saturday, Jan 18, 2026</div>
            <div class="timeline-content">
              <div class="timeline-title">üèÜ Match Victory</div>
              <div class="timeline-text">Glenorchy Knights defeated Kingborough Lions 3-1. Finn scored 1 goal and provided 1 assist in an excellent performance!</div>
              <span class="timeline-source">Sport</span>
            </div>
          </div>
          
          <div class="timeline-item" data-category="calendar">
            <div class="timeline-date">Wednesday, Jan 15, 2026</div>
            <div class="timeline-content">
              <div class="timeline-title">üìÖ Family Planning Meeting</div>
              <div class="timeline-text">Reviewed upcoming Japan trip plans and finalized bookings for accommodation and activities.</div>
              <span class="timeline-source">Calendar</span>
            </div>
          </div>
          
          <div class="timeline-item" data-category="memories">
            <div class="timeline-date">Wednesday, Jan 1, 2026</div>
            <div class="timeline-content">
              <div class="timeline-title">üéä New Year 2026</div>
              <div class="timeline-text">Celebrated New Year with family. Started the year with plans for Japan trip and Finn's continued success with State Team.</div>
              <span class="timeline-source">Memories</span>
            </div>
          </div>
          
          <div class="timeline-item" data-category="memories">
            <div class="timeline-date">Thursday, Dec 25, 2025</div>
            <div class="timeline-content">
              <div class="timeline-title">üéÑ Christmas Day</div>
              <div class="timeline-text">Wonderful family Christmas celebration. Finn and Darcy loved their presents and we enjoyed a beautiful day together.</div>
              <span class="timeline-source">Memories</span>
            </div>
          </div>
          
          <div class="timeline-item" data-category="sport">
            <div class="timeline-date">Sunday, Nov 17, 2025</div>
            <div class="timeline-content">
              <div class="timeline-title">‚öΩ State Team Selection</div>
              <div class="timeline-text">Finn selected for Tasmania State Soccer Team! Incredible achievement recognizing his hard work and dedication.</div>
              <span class="timeline-source">Sport</span>
            </div>
          </div>
          
          <div class="timeline-item" data-category="trips">
            <div class="timeline-date">Saturday, Nov 8, 2025</div>
            <div class="timeline-content">
              <div class="timeline-title">‚úàÔ∏è Sydney Weekend Trip</div>
              <div class="timeline-text">Family weekend in Sydney visiting Darling Harbour, Luna Park and Sydney Opera House.</div>
              <span class="timeline-source">Trips</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- TASKS PAGE - FULL VERSION -->
    <div id="page-tasks" class="page">
      <div class="page-header">
        <h1 class="page-title">Family Tasks</h1>
        <p class="page-subtitle">Stay organized together</p>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Task Manager</h2>
          <button class="btn btn-small" onclick="openModal('taskModal')">Add Task</button>
        </div>
        <div class="task-tabs">
          <button class="task-tab active" onclick="showTaskTab('family')">Family</button>
          <button class="task-tab" onclick="showTaskTab('school')">School</button>
          <button class="task-tab" onclick="showTaskTab('sport')">Sport</button>
        </div>
        
        <!-- Family Tasks -->
        <div id="task-family" class="task-content active">
          <div class="task-list" id="taskList-family">
            <div class="task-item" onclick="toggleTask(this)">
              <div class="task-checkbox"></div>
              <div class="task-text">Finalize Japan accommodation bookings</div>
            </div>
            <div class="task-item" onclick="toggleTask(this)">
              <div class="task-checkbox"></div>
              <div class="task-text">Book Mt Fuji day tour</div>
            </div>
            <div class="task-item" onclick="toggleTask(this)">
              <div class="task-checkbox"></div>
              <div class="task-text">Organize family photos from December</div>
            </div>
            <div class="task-item" onclick="toggleTask(this)">
              <div class="task-checkbox"></div>
              <div class="task-text">Sort old clothes for donation</div>
            </div>
            <div class="task-item completed" onclick="toggleTask(this)">
              <div class="task-checkbox">‚úì</div>
              <div class="task-text">Plan weekly meal prep</div>
            </div>
            <div class="task-item completed" onclick="toggleTask(this)">
              <div class="task-checkbox">‚úì</div>
              <div class="task-text">Book Disney tickets for Japan</div>
            </div>
          </div>
        </div>
        
        <!-- School Tasks -->
        <div id="task-school" class="task-content">
          <div class="task-list" id="taskList-school">
            <div class="task-item" onclick="toggleTask(this)">
              <div class="task-checkbox"></div>
              <div class="task-text">Buy school supplies for Term 1</div>
            </div>
            <div class="task-item" onclick="toggleTask(this)">
              <div class="task-checkbox"></div>
              <div class="task-text">Complete uniform name tags</div>
            </div>
            <div class="task-item" onclick="toggleTask(this)">
              <div class="task-checkbox"></div>
              <div class="task-text">Sign Term 1 permission forms</div>
            </div>
            <div class="task-item completed" onclick="toggleTask(this)">
              <div class="task-checkbox">‚úì</div>
              <div class="task-text">Register for parent-teacher meetings</div>
            </div>
            <div class="task-item completed" onclick="toggleTask(this)">
              <div class="task-checkbox">‚úì</div>
              <div class="task-text">Pay school fees for 2026</div>
            </div>
          </div>
        </div>
        
        <!-- Sport Tasks -->
        <div id="task-sport" class="task-content">
          <div class="task-list" id="taskList-sport">
            <div class="task-item" onclick="toggleTask(this)">
              <div class="task-checkbox"></div>
              <div class="task-text">Wash Finn's soccer kits</div>
            </div>
            <div class="task-item" onclick="toggleTask(this)">
              <div class="task-checkbox"></div>
              <div class="task-text">Register for upcoming tournament</div>
            </div>
            <div class="task-item" onclick="toggleTask(this)">
              <div class="task-checkbox"></div>
              <div class="task-text">Buy new soccer boots (size 10)</div>
            </div>
            <div class="task-item" onclick="toggleTask(this)">
              <div class="task-checkbox"></div>
              <div class="task-text">Organize carpool for away match</div>
            </div>
            <div class="task-item completed" onclick="toggleTask(this)">
              <div class="task-checkbox">‚úì</div>
              <div class="task-text">Pay team fees for this term</div>
            </div>
            <div class="task-item completed" onclick="toggleTask(this)">
              <div class="task-checkbox">‚úì</div>
              <div class="task-text">Submit State Team medical forms</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- SCHOOL PAGE - FULL VERSION -->
    <div id="page-school" class="page">
      <div class="page-header">
        <h1 class="page-title">School Resources</h1>
        <p class="page-subtitle">St Virgil's College information and links</p>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Important Links</h2>
        </div>
        <div class="link-list">
          <a href="https://www.svc.tas.edu.au" target="_blank" class="link-item">
            <svg class="link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>
            St Virgil's College Website
          </a>
          <a href="https://www.svc.tas.edu.au/parent-portal" target="_blank" class="link-item">
            <svg class="link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
            Parent Portal Login
          </a>
          <a href="https://www.svc.tas.edu.au/calendar" target="_blank" class="link-item">
            <svg class="link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
            School Calendar 2026
          </a>
          <a href="/cdn-cgi/l/email-protection#e48580898d8aa4979287ca908597ca818091ca8591" class="link-item">
            <svg class="link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
            Contact School Office
          </a>
          <a href="https://www.svc.tas.edu.au/uniform" target="_blank" class="link-item">
            <svg class="link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><polyline points="17 11 19 13 23 9"></polyline></svg>
            Uniform Shop
          </a>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">üìÖ Term Dates 2026</h2>
        </div>
        <div style="display: grid; gap: 1rem;">
          <div style="background: var(--bg-light); padding: 1.25rem; border-radius: 8px; border-left: 4px solid var(--primary);">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 0.25rem;">Term 1</div>
                <div style="color: var(--text-medium);">February 3 - April 9, 2026</div>
              </div>
              <div style="background: var(--primary); color: white; padding: 0.5rem 1rem; border-radius: 6px; font-weight: 600; font-size: 0.85rem;">10 weeks</div>
            </div>
          </div>
          <div style="background: var(--bg-light); padding: 1.25rem; border-radius: 8px; border-left: 4px solid var(--secondary);">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 0.25rem;">Term 2</div>
                <div style="color: var(--text-medium);">April 27 - July 3, 2026</div>
              </div>
              <div style="background: var(--secondary); color: white; padding: 0.5rem 1rem; border-radius: 6px; font-weight: 600; font-size: 0.85rem;">10 weeks</div>
            </div>
          </div>
          <div style="background: var(--bg-light); padding: 1.25rem; border-radius: 8px; border-left: 4px solid var(--accent);">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 0.25rem;">Term 3</div>
                <div style="color: var(--text-medium);">July 20 - September 25, 2026</div>
              </div>
              <div style="background: var(--accent); color: white; padding: 0.5rem 1rem; border-radius: 6px; font-weight: 600; font-size: 0.85rem;">10 weeks</div>
            </div>
          </div>
          <div style="background: var(--bg-light); padding: 1.25rem; border-radius: 8px; border-left: 4px solid #10b981;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 0.25rem;">Term 4</div>
                <div style="color: var(--text-medium);">October 12 - December 11, 2026</div>
              </div>
              <div style="background: #10b981; color: white; padding: 0.5rem 1rem; border-radius: 6px; font-weight: 600; font-size: 0.85rem;">9 weeks</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">üìû Contact Information</h2>
        </div>
        <div style="display: grid; gap: 1rem;">
          <div style="display: flex; gap: 1rem; padding: 1rem; background: var(--bg-light); border-radius: 6px;">
            <div style="width: 40px; height: 40px; background: var(--primary); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.25rem; flex-shrink: 0;">üìß</div>
            <div>
              <div style="font-weight: 600; margin-bottom: 0.25rem;">Email</div>
              <div style="color: var(--text-medium);"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c1a0a5aca8af81b2b7a2efb5a0b2efa4a5b4efa0b4">[email&#160;protected]</a></div>
            </div>
          </div>
          <div style="display: flex; gap: 1rem; padding: 1rem; background: var(--bg-light); border-radius: 6px;">
            <div style="width: 40px; height: 40px; background: var(--primary); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.25rem; flex-shrink: 0;">üì±</div>
            <div>
              <div style="font-weight: 600; margin-bottom: 0.25rem;">Phone</div>
              <div style="color: var(--text-medium);">(03) 6108 5300</div>
            </div>
          </div>
          <div style="display: flex; gap: 1rem; padding: 1rem; background: var(--bg-light); border-radius: 6px;">
            <div style="width: 40px; height: 40px; background: var(--primary); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.25rem; flex-shrink: 0;">üìç</div>
            <div>
              <div style="font-weight: 600; margin-bottom: 0.25rem;">Address</div>
              <div style="color: var(--text-medium);">Patrick St, Hobart TAS 7000</div>
            </div>
          </div>
        </div>
      </div>
    </div>

  <nav class="bottom-nav">
    <div class="nav-container">
      <div class="nav-item active" data-page="home" onclick="navigateTo('home')">
        <svg class="nav-icon" viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg>
        <span>Home</span>
      </div>
      <div class="nav-item" data-page="calendar" onclick="navigateTo('calendar')">
        <svg class="nav-icon" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
        <span>Calendar</span>
      </div>
      <div class="nav-item" data-page="trips" onclick="navigateTo('trips')">
        <svg class="nav-icon" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
        <span>Trips</span>
      </div>
      <div class="nav-item" data-page="sport" onclick="navigateTo('sport')">
        <svg class="nav-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path><path d="M2 12h20"></path></svg>
        <span>Sport</span>
      </div>
      <div class="nav-item" data-page="tasks" onclick="navigateTo('tasks')">
        <svg class="nav-icon" viewBox="0 0 24 24"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
        <span>Tasks</span>
      </div>
      <div class="nav-item" data-page="health" onclick="navigateTo('health')">
        <svg class="nav-icon" viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>
        <span>Health</span>
      </div>
    </div>
  </nav>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script>
    // =====================================================
    // FIREBASE CONFIGURATION
    // =====================================================
    // SETUP: Replace these values with your Firebase project config.
    // See instructions at the bottom of this file or in the README.
    var firebaseConfig = {
      apiKey: "",
      authDomain: "",
      projectId: "",
      storageBucket: "",
      messagingSenderId: "",
      appId: ""
    };

    var FIREBASE_ENABLED = false;
    var db = null;
    if (firebaseConfig.apiKey && firebaseConfig.projectId) {
      try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        FIREBASE_ENABLED = true;
      } catch(e) { console.warn('Firebase init failed:', e); }
    }

    // =====================================================
    // AUTHENTICATION (PIN stored in Firestore when available)
    // =====================================================
    async function hashPin(pin) {
      var enc = new TextEncoder().encode(pin + 'familyhub');
      var hash = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(hash)).map(function(b) { return b.toString(16).padStart(2, '0'); }).join('');
    }

    async function checkAuth() {
      var session = sessionStorage.getItem('fh_session');
      var overlay = document.getElementById('loginOverlay');
      if (session === 'active') {
        overlay.classList.add('hidden');
        return;
      }
      overlay.classList.remove('hidden');
      var hasPin = false;
      if (FIREBASE_ENABLED) {
        try {
          var doc = await db.collection('familyhub').doc('config').get();
          hasPin = doc.exists && doc.data().pin;
        } catch(e) { hasPin = !!localStorage.getItem('fh_pin'); }
      } else {
        hasPin = !!localStorage.getItem('fh_pin');
      }
      if (hasPin) {
        document.getElementById('loginTitle').textContent = 'Enter Your PIN';
        document.getElementById('loginSubtitle').textContent = 'Enter your 4-digit PIN to access Family Hub';
        document.getElementById('loginBtn').textContent = 'Login';
      } else {
        document.getElementById('loginTitle').textContent = 'Set Your PIN';
        document.getElementById('loginSubtitle').textContent = 'Choose a 4-digit PIN to secure your Family Hub';
        document.getElementById('loginBtn').textContent = 'Set PIN';
      }
    }

    async function handleLogin(e) {
      e.preventDefault();
      var pin = document.getElementById('pinInput').value;
      var errorEl = document.getElementById('loginError');
      if (pin.length !== 4 || !/^\d{4}$/.test(pin)) {
        errorEl.textContent = 'Please enter a 4-digit PIN';
        return;
      }
      var hashed = await hashPin(pin);
      var storedPin = null;
      if (FIREBASE_ENABLED) {
        try {
          var doc = await db.collection('familyhub').doc('config').get();
          storedPin = (doc.exists && doc.data().pin) ? doc.data().pin : null;
        } catch(e) { storedPin = localStorage.getItem('fh_pin'); }
      } else {
        storedPin = localStorage.getItem('fh_pin');
      }
      if (!storedPin) {
        // First time ‚Äî set PIN
        localStorage.setItem('fh_pin', hashed);
        if (FIREBASE_ENABLED) {
          try { await db.collection('familyhub').doc('config').set({ pin: hashed }); } catch(e) {}
        }
        sessionStorage.setItem('fh_session', 'active');
        document.getElementById('loginOverlay').classList.add('hidden');
        errorEl.textContent = '';
      } else if (hashed === storedPin) {
        sessionStorage.setItem('fh_session', 'active');
        document.getElementById('loginOverlay').classList.add('hidden');
        errorEl.textContent = '';
      } else {
        errorEl.textContent = 'Incorrect PIN. Please try again.';
        document.getElementById('pinInput').value = '';
      }
    }

    function logout() {
      sessionStorage.removeItem('fh_session');
      document.getElementById('pinInput').value = '';
      document.getElementById('loginError').textContent = '';
      checkAuth();
    }

    // =====================================================
    // DATA STORE (Firestore + localStorage cache)
    // =====================================================
    var Store = {
      _cache: {},
      _ready: false,

      get: function(key) {
        if (this._cache[key] !== undefined) return this._cache[key];
        var local = localStorage.getItem('fh_' + key);
        if (local) { try { this._cache[key] = JSON.parse(local); return this._cache[key]; } catch(e) {} }
        return null;
      },

      set: function(key, data) {
        this._cache[key] = data;
        localStorage.setItem('fh_' + key, JSON.stringify(data));
        if (FIREBASE_ENABLED && db) {
          db.collection('familyhub').doc(key).set({ data: data }).catch(function(e) { console.warn('Firestore write failed:', e); });
        }
      },

      getNextId: function(key) {
        var data = this.get(key);
        if (!data || !Array.isArray(data)) return 1;
        var maxId = 0;
        for (var i = 0; i < data.length; i++) { if (data[i].id > maxId) maxId = data[i].id; }
        return maxId + 1;
      },

      // Set up real-time Firestore listeners
      initListeners: function() {
        if (!FIREBASE_ENABLED || !db) return;
        var self = this;
        var renderMap = {
          events: function() { renderCalendar(); renderUpcomingEvents(); },
          tasks: function() { renderTasks(); },
          health: function() { renderHealthRecords(); },
          sport_entries: function() { renderSportEntries(); },
          photos: function() { renderPhotos(); },
          memories: function() { renderMemories(); }
        };
        var keys = Object.keys(renderMap);
        keys.forEach(function(key) {
          db.collection('familyhub').doc(key).onSnapshot(function(doc) {
            if (doc.exists && doc.data().data !== undefined) {
              self._cache[key] = doc.data().data;
              localStorage.setItem('fh_' + key, JSON.stringify(doc.data().data));
              if (self._ready && renderMap[key]) renderMap[key]();
            }
          }, function(err) { console.warn('Listener error for ' + key + ':', err); });
        });
      }
    };

    // =====================================================
    // SEED DEFAULT DATA (only if no data exists yet)
    // =====================================================
    function seedDefaultData(callback) {
      var defaults = {
        events: [
          { id: 1, title: "\u26bd State Team Training", date: "2026-01-12", time: "10:00 - 12:00", category: "sport", recurring: "weekly", location: "KGV Oval", participant: "Finn", sport: "Soccer" },
          { id: 2, title: "\u26bd Glenorchy Knights vs Kingborough Lions", date: "2026-01-18", time: "14:00", category: "sport", recurring: false, location: "KGV Oval", participant: "Finn", sport: "Soccer" },
          { id: 3, title: "\u26bd State Team Training", date: "2026-01-26", time: "10:00 - 12:00", category: "sport", recurring: "weekly", location: "KGV Oval", participant: "Finn", sport: "Soccer" },
          { id: 4, title: "\u26bd State Team Training", date: "2026-01-29", time: "10:00 - 12:00", category: "sport", recurring: "weekly", location: "KGV Oval", participant: "Finn", sport: "Soccer" },
          { id: 5, title: "Japan Planning Meeting", date: "2026-01-30", time: "19:00", category: "travel", recurring: false, location: "Home" },
          { id: 6, title: "\ud83c\udfc0 Darcy Basketball", date: "2026-01-31", time: "16:00 - 17:30", category: "sport", recurring: false, location: "School Gym", participant: "Darcy", sport: "Basketball" },
          { id: 7, title: "Family Dinner", date: "2026-02-01", time: "18:30", category: "family", recurring: false, location: "Salamanca" },
          { id: 8, title: "\u26bd Finn's Match Day", date: "2026-02-02", time: "14:00", category: "sport", recurring: false, location: "Glenorchy", participant: "Finn", sport: "Soccer" },
          { id: 9, title: "School Term Starts", date: "2026-02-03", time: "08:30", category: "school", recurring: false, location: "St Virgil's" },
          { id: 10, title: "Health Checkup", date: "2026-02-04", time: "09:00", category: "health", recurring: false, location: "Medical Centre" },
          { id: 11, title: "\u26bd Glenorchy Knights Training", date: "2026-02-04", time: "17:30 - 19:00", category: "sport", recurring: "weekly", location: "Glenorchy Soccer Club", participant: "Finn", sport: "Soccer" },
          { id: 12, title: "\u26bd Glenorchy Knights Training", date: "2026-02-06", time: "17:30 - 19:00", category: "sport", recurring: "weekly", location: "Glenorchy Soccer Club", participant: "Finn", sport: "Soccer" }
        ],
        tasks: {
          family: [
            { id: 1, text: "Finalize Japan accommodation bookings", completed: false },
            { id: 2, text: "Book Mt Fuji day tour", completed: false },
            { id: 3, text: "Organize family photos from December", completed: false },
            { id: 4, text: "Sort old clothes for donation", completed: false },
            { id: 5, text: "Plan weekly meal prep", completed: true },
            { id: 6, text: "Book Disney tickets for Japan", completed: true }
          ],
          school: [
            { id: 1, text: "Buy school supplies for Term 1", completed: false },
            { id: 2, text: "Complete uniform name tags", completed: false },
            { id: 3, text: "Sign Term 1 permission forms", completed: false },
            { id: 4, text: "Register for parent-teacher meetings", completed: true },
            { id: 5, text: "Pay school fees for 2026", completed: true }
          ],
          sport: [
            { id: 1, text: "Wash Finn's soccer kits", completed: false },
            { id: 2, text: "Register for upcoming tournament", completed: false },
            { id: 3, text: "Buy new soccer boots (size 10)", completed: false },
            { id: 4, text: "Organize carpool for away match", completed: false },
            { id: 5, text: "Pay team fees for this term", completed: true },
            { id: 6, text: "Submit State Team medical forms", completed: true }
          ]
        },
        health: [
          { id: 1, person: "finn", name: "Finn", date: "15/01/2026", detail: "Annual sports physical - cleared for all activities", attachments: [{ name: "Physical Report.pdf" }, { name: "Clearance Form.pdf" }] },
          { id: 2, person: "darcy", name: "Darcy", date: "08/01/2026", detail: "Eye test - new prescription, glasses ordered", attachments: [{ name: "Prescription.pdf" }, { name: "Vision Test Results" }] },
          { id: 3, person: "evan", name: "Evan", date: "20/12/2025", detail: "Annual checkup - all clear, continue current fitness routine", attachments: [{ name: "Blood Work Results.pdf" }] }
        ],
        sport_entries: [
          { id: 1, title: "State Team Training Session", date: "2026-01-26", time: "10:00am", type: "training", participant: "Finn", sport: "soccer", notes: "Regular Sunday morning training session with Tasmania State Team at KGV Oval. Focused on passing drills, set pieces, and small-sided games.", result: "Excellent effort and attitude. Continuing to improve ball control and spatial awareness." },
          { id: 2, title: "Glenorchy Knights vs Kingborough Lions SC", date: "2026-01-18", time: "2:00pm", type: "match", participant: "Finn", sport: "soccer", notes: "NPL Tasmania U16 league match at KGV Oval. Finn started as attacking midfielder and played 75 minutes.", result: "Glenorchy Knights 3 - 1 Kingborough Lions" },
          { id: 3, title: "State Team Training Session", date: "2026-01-12", time: "10:00am", type: "training", participant: "Finn", sport: "soccer", notes: "First training session of 2026 with the State Team. Focus on fitness and conditioning after the break.", result: "Good return to training. Fitness levels maintained over break." }
        ],
        photos: [
          { id: 1, title: "Christmas 2025", date: "Dec 25", year: "2025" },
          { id: 2, title: "Finn's Match Win", date: "Jan 18", year: "2026" },
          { id: 3, title: "Family Dinner", date: "Nov 20", year: "2025" },
          { id: 4, title: "Beach Trip", date: "Oct 15", year: "2025" },
          { id: 5, title: "Birthday Party", date: "Jan 5", year: "2026" },
          { id: 6, title: "School Event", date: "Dec 10", year: "2025" },
          { id: 7, title: "Soccer Finals", date: "Nov 5", year: "2025" },
          { id: 8, title: "New Year 2026", date: "Jan 1", year: "2026" }
        ],
        memories: [
          { id: 1, date: "January 2026", title: "Website Launch", text: "Successfully launched our Family Hub website! Now we can keep track of everything in one place.", hasPhotos: false },
          { id: 2, date: "December 2025", title: "Family Christmas", text: "Wonderful Christmas celebration with the whole family. Finn and Darcy loved their gifts.", hasPhotos: true },
          { id: 3, date: "November 2025", title: "Finn Selected for State Team", text: "Incredible news! Finn was selected for the Tasmania State soccer team.", hasPhotos: false },
          { id: 4, date: "October 2025", title: "Darcy's Gaming Tournament", text: "Darcy competed in his first major gaming tournament and placed in the top 10.", hasPhotos: true },
          { id: 5, date: "September 2025", title: "Weekend at Bruny Island", text: "Perfect family weekend away at Bruny Island. Explored the lighthouse, tried fresh oysters.", hasPhotos: false }
        ]
      };

      var keys = Object.keys(defaults);

      if (FIREBASE_ENABLED && db) {
        // Check Firestore first ‚Äî only seed if empty
        db.collection('familyhub').doc('events').get().then(function(doc) {
          if (!doc.exists) {
            keys.forEach(function(key) { Store.set(key, defaults[key]); });
          }
          if (callback) callback();
        }).catch(function() {
          // Offline / error ‚Äî seed localStorage if empty
          keys.forEach(function(key) { if (!Store.get(key)) Store.set(key, defaults[key]); });
          if (callback) callback();
        });
      } else {
        keys.forEach(function(key) { if (!Store.get(key)) Store.set(key, defaults[key]); });
        if (callback) callback();
      }
    }

    // =====================================================
    // NAVIGATION
    // =====================================================
    function navigateTo(page) {
      var pages = document.querySelectorAll('.page');
      for (var i = 0; i < pages.length; i++) {
        pages[i].classList.remove('active');
      }
      var targetPage = document.getElementById('page-' + page);
      if (targetPage) targetPage.classList.add('active');

      var navItems = document.querySelectorAll('.nav-item');
      for (var i = 0; i < navItems.length; i++) {
        navItems[i].classList.remove('active');
        if (navItems[i].dataset.page === page) navItems[i].classList.add('active');
      }
      window.scrollTo(0, 0);

      // Re-render dynamic content when navigating to page
      if (page === 'health') renderHealthRecords();
      if (page === 'sport') renderSportEntries();
      if (page === 'photos') renderPhotos();
      if (page === 'memories') renderMemories();
      if (page === 'tasks') renderTasks();
      if (page === 'calendar') renderCalendar();
    }

    // =====================================================
    // COUNTDOWN
    // =====================================================
    function updateCountdown() {
      var japanDate = new Date('2026-10-01T00:00:00');
      var now = new Date();
      var days = Math.floor((japanDate - now) / (1000 * 60 * 60 * 24));
      document.getElementById('daysToJapan').textContent = days;
    }
    setInterval(updateCountdown, 60000);
    updateCountdown();

    // =====================================================
    // UPCOMING EVENTS (Home page)
    // =====================================================
    function renderUpcomingEvents() {
      var container = document.getElementById('upcomingEventsHome');
      if (!container) return;
      var eventsData = Store.get('events') || [];
      var html = '';
      var today = new Date();
      today.setHours(0, 0, 0, 0);

      for (var i = 0; i < eventsData.length; i++) {
        var evt = eventsData[i];
        var eventDate = new Date(evt.date);
        eventDate.setHours(0, 0, 0, 0);
        var daysDiff = Math.floor((eventDate - today) / (1000 * 60 * 60 * 24));
        if (daysDiff >= 0 && daysDiff < 7) {
          var dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
          var monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
          var dateLabel = daysDiff === 0 ? 'TODAY' : dayNames[eventDate.getDay()] + ', ' + monthNames[eventDate.getMonth()] + ' ' + eventDate.getDate();
          html += '<div class="upcoming-event ' + evt.category + '" onclick="navigateTo(\'calendar\')">';
          html += '<div class="event-date">' + dateLabel + '</div>';
          if (evt.time) html += '<div class="event-time">' + evt.time + '</div>';
          html += '<div class="event-title">' + evt.title + '</div>';
          html += '</div>';
        }
      }
      if (!html) html = '<div style="padding: 2rem; text-align: center; color: #6b7280;">No events in the next 7 days</div>';
      container.innerHTML = html;
    }

    // =====================================================
    // CALENDAR
    // =====================================================
    var currentDate = new Date();

    function renderCalendar() {
      var eventsData = Store.get('events') || [];
      var year = currentDate.getFullYear();
      var month = currentDate.getMonth();
      var monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      document.getElementById('currentMonth').textContent = monthNames[month] + ' ' + year;
      var firstDay = new Date(year, month, 1).getDay();
      var daysInMonth = new Date(year, month + 1, 0).getDate();
      var grid = document.getElementById('calendarGrid');
      grid.innerHTML = '';

      var dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      dayNames.forEach(function(day) {
        var header = document.createElement('div');
        header.className = 'calendar-day-header';
        header.textContent = day;
        grid.appendChild(header);
      });

      for (var i = 0; i < firstDay; i++) {
        grid.appendChild(document.createElement('div'));
      }

      var today = new Date();
      for (var day = 1; day <= daysInMonth; day++) {
        var dayEl = document.createElement('div');
        dayEl.className = 'calendar-day';
        var dayNum = document.createElement('div');
        dayNum.className = 'calendar-day-number';
        dayNum.textContent = day;
        dayEl.appendChild(dayNum);

        if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
          dayEl.classList.add('today');
        }

        var dateStr = year + '-' + String(month + 1).padStart(2, '0') + '-' + String(day).padStart(2, '0');
        var dayEvents = eventsData.filter(function(e) { return e.date === dateStr; });

        if (dayEvents.length > 0) {
          dayEl.classList.add('has-event');
          var eventsContainer = document.createElement('div');
          eventsContainer.className = 'calendar-events';
          dayEvents.forEach(function(evt) {
            var eventEl = document.createElement('div');
            eventEl.className = 'calendar-event ' + evt.category + (evt.recurring ? ' recurring' : '');
            eventEl.innerHTML = (evt.time ? '<span class="calendar-event-time">' + evt.time + '</span> ' : '') + evt.title;
            eventEl.title = evt.title + ' - ' + (evt.location || '');
            eventsContainer.appendChild(eventEl);
          });
          dayEl.appendChild(eventsContainer);
        }
        grid.appendChild(dayEl);
      }
      renderEventList();
    }

    function renderEventList() {
      var eventList = document.getElementById('eventList');
      if (!eventList) return;
      var eventsData = Store.get('events') || [];
      var sortedEvents = eventsData.slice().sort(function(a, b) { return new Date(a.date) - new Date(b.date); });

      eventList.innerHTML = sortedEvents.map(function(evt) {
        return '<div class="event-item" style="position:relative;">' +
          '<button class="delete-btn" onclick="event.stopPropagation(); deleteEvent(' + evt.id + ')" title="Delete event" style="position:absolute;top:0.75rem;right:0.75rem;">‚úï</button>' +
          '<div class="event-item-header"><div class="event-item-title">' + evt.title + '</div><div class="event-item-time">' + (evt.time || '') + '</div></div>' +
          '<div class="event-item-details">' + new Date(evt.date).toLocaleDateString('en-AU', { weekday: 'long', day: 'numeric', month: 'long' }) + (evt.location ? ' &bull; ' + evt.location : '') + '</div>' +
          '<div class="event-item-meta">' +
            (evt.participant ? '<span class="event-badge">üë§ ' + evt.participant + '</span>' : '') +
            (evt.sport ? '<span class="event-badge">üèÖ ' + evt.sport + '</span>' : '') +
            (evt.recurring ? '<span class="event-badge recurring">üîÅ Recurring - ' + evt.recurring.charAt(0).toUpperCase() + evt.recurring.slice(1) + '</span>' : '') +
            '<span class="event-badge">' + getCategoryIcon(evt.category) + ' ' + evt.category.charAt(0).toUpperCase() + evt.category.slice(1) + '</span>' +
          '</div></div>';
      }).join('');
    }

    function getCategoryIcon(category) {
      var icons = { sport: '‚öΩ', school: 'üìö', health: 'üíä', travel: '‚úàÔ∏è', family: 'üë®‚Äçüë©‚Äçüë¶' };
      return icons[category] || 'üìå';
    }

    function changeMonth(delta) {
      currentDate.setMonth(currentDate.getMonth() + delta);
      renderCalendar();
    }

    // =====================================================
    // EXPORT CALENDAR
    // =====================================================
    function exportCalendar() {
      var eventsData = Store.get('events') || [];
      var icsContent = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Family Hub//EN\nCALSCALE:GREGORIAN\nMETHOD:PUBLISH\nX-WR-CALNAME:Family Hub Calendar\nX-WR-TIMEZONE:Australia/Sydney\n\n';
      eventsData.forEach(function(evt) {
        var eventDate = evt.date.replace(/-/g, '');
        var eventTime = evt.time ? evt.time.replace(':', '') + '00' : '000000';
        var stamp = new Date().toISOString().replace(/[-:]/g, '').replace(/\.\d{3}/, '');
        icsContent += 'BEGIN:VEVENT\nUID:' + evt.id + '@familyhub.local\nDTSTAMP:' + stamp + '\nDTSTART;TZID=Australia/Sydney:' + eventDate + 'T' + eventTime + '\nSUMMARY:' + evt.title + '\nLOCATION:' + (evt.location || '') + '\nDESCRIPTION:Category: ' + evt.category + (evt.recurring ? ' | Recurring: ' + evt.recurring : '') + '\nSTATUS:CONFIRMED\nEND:VEVENT\n\n';
      });
      icsContent += 'END:VCALENDAR';
      var blob = new Blob([icsContent], { type: 'text/calendar' });
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url;
      a.download = 'family-hub-calendar.ics';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      alert('Calendar exported! Subscribe to this .ics file in your iPhone Calendar app:\n\nSettings ‚Üí Calendar ‚Üí Accounts ‚Üí Add Account ‚Üí Other ‚Üí Add Subscribed Calendar');
    }

    // =====================================================
    // WORLD MAP
    // =====================================================
    var map;
    function initMap() {
      map = L.map('worldMap', { center: [20, 100], zoom: 2, minZoom: 2, maxZoom: 8 });
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap contributors' }).addTo(map);
      var destinations = [
        { name: 'Japan 2026', coords: [35.6762, 139.6503], status: 'upcoming', dates: '1-13 Oct 2026' },
        { name: 'Melbourne', coords: [-37.8136, 144.9631], status: 'upcoming', dates: '15-17 Mar 2026' },
        { name: 'Tasmania', coords: [-42.8821, 147.3272], status: 'visited', dates: 'Dec 2025' },
        { name: 'Sydney', coords: [-33.8688, 151.2093], status: 'visited', dates: 'Nov 2025' }
      ];
      destinations.forEach(function(dest) {
        var color = dest.status === 'upcoming' ? '#2563eb' : '#10b981';
        var icon = L.divIcon({
          className: 'custom-marker',
          html: '<div style="background: ' + color + '; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"></div>',
          iconSize: [24, 24]
        });
        L.marker(dest.coords, { icon: icon }).addTo(map).bindPopup(
          '<div class="popup-title">' + dest.name + '</div>' +
          '<div style="font-size:0.85rem;color:var(--text-medium);">' + dest.dates + '</div>' +
          '<div style="margin-top:0.5rem;font-size:0.8rem;color:' + color + ';font-weight:600;">' + (dest.status === 'upcoming' ? 'üìç Upcoming' : '‚úì Visited') + '</div>'
        );
      });
    }
    setTimeout(function() {
      if (typeof L !== 'undefined') initMap();
      else setTimeout(initMap, 500);
    }, 500);

    // =====================================================
    // MODAL FUNCTIONS
    // =====================================================
    function openModal(modalId) {
      document.getElementById(modalId).classList.add('active');
    }
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }

    // =====================================================
    // RENDER: HEALTH RECORDS
    // =====================================================
    var currentHealthFilter = 'all';
    function renderHealthRecords(filterPerson) {
      if (filterPerson !== undefined) currentHealthFilter = filterPerson;
      var container = document.getElementById('healthGrid');
      if (!container) return;
      var records = Store.get('health') || [];
      var attachIcon = '<svg class="attachment-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path></svg>';
      var html = '';
      for (var i = 0; i < records.length; i++) {
        var r = records[i];
        if (currentHealthFilter !== 'all' && r.person !== currentHealthFilter) continue;
        html += '<div class="health-record" data-person="' + r.person + '" style="position:relative;">';
        html += '<button class="delete-btn" onclick="event.stopPropagation(); deleteHealthRecord(' + r.id + ')" title="Delete record" style="position:absolute;top:0.75rem;right:0.75rem;">‚úï</button>';
        html += '<div class="health-header"><span class="health-name">' + r.name + '</span><span class="health-date">' + r.date + '</span></div>';
        html += '<div class="health-detail">' + r.detail + '</div>';
        if (r.attachments && r.attachments.length) {
          html += '<div class="health-attachments">';
          for (var j = 0; j < r.attachments.length; j++) {
            html += '<a href="#" class="event-attachment">' + attachIcon + ' ' + r.attachments[j].name + '</a>';
          }
          html += '</div>';
        }
        html += '</div>';
      }
      if (!html) html = '<div style="padding:2rem;text-align:center;color:#6b7280;">No health records found</div>';
      container.innerHTML = html;
    }

    function filterHealth(person) {
      renderHealthRecords(person);
    }

    // =====================================================
    // RENDER: SPORT ENTRIES
    // =====================================================
    function renderSportEntries() {
      var container = document.getElementById('sportEntriesList');
      if (!container) return;
      var entries = Store.get('sport_entries') || [];
      var html = '';
      for (var i = 0; i < entries.length; i++) {
        var e = entries[i];
        var badge = e.type === 'match' ? 'üèÜ Match' : '‚öΩ Training';
        html += '<div class="sport-entry" style="position:relative;">';
        html += '<button class="delete-btn" onclick="event.stopPropagation(); deleteSportEntry(' + e.id + ')" title="Delete entry" style="position:absolute;top:1rem;right:1rem;">‚úï</button>';
        html += '<div class="sport-entry-header"><div>';
        html += '<div class="sport-entry-title">' + e.title + '</div>';
        html += '<div style="color:var(--text-medium);font-size:0.9rem;">üìÖ ' + e.date + ' &bull; ' + e.time + '</div>';
        html += '</div><div class="sport-badge">' + badge + '</div></div>';
        html += '<div style="margin:1rem 0;">' + e.notes + '</div>';
        if (e.result) {
          html += '<div class="sport-result"><div style="font-weight:600;margin-bottom:0.5rem;">' + (e.type === 'match' ? 'üéØ Result:' : 'üìä Performance Notes:') + '</div>';
          html += '<div style="color:var(--text-medium);">' + e.result + '</div></div>';
        }
        html += '</div>';
      }
      if (!html) html = '<div style="padding:2rem;text-align:center;color:#6b7280;">No sport entries yet</div>';
      container.innerHTML = html;
    }

    // =====================================================
    // RENDER: PHOTOS
    // =====================================================
    var currentPhotoFilter = 'all';
    function renderPhotos(filterYear) {
      if (filterYear !== undefined) currentPhotoFilter = filterYear;
      var container = document.getElementById('photoGrid');
      if (!container) return;
      var photos = Store.get('photos') || [];
      var html = '';
      for (var i = 0; i < photos.length; i++) {
        var p = photos[i];
        if (currentPhotoFilter !== 'all' && p.year !== currentPhotoFilter) continue;
        html += '<div class="photo-card" data-year="' + p.year + '">';
        html += '<div class="photo-placeholder">üì∑</div>';
        html += '<div class="photo-info">' + p.title + '<br><span style="font-size:0.75rem;opacity:0.8;">' + p.date + '</span></div>';
        html += '</div>';
      }
      if (!html) html = '<div style="padding:2rem;text-align:center;color:#6b7280;">No photos found</div>';
      container.innerHTML = html;
    }

    function filterPhotos(year) {
      renderPhotos(year);
    }

    // =====================================================
    // RENDER: MEMORIES
    // =====================================================
    function renderMemories() {
      var container = document.getElementById('memoryTimeline');
      if (!container) return;
      var memories = Store.get('memories') || [];
      var html = '';
      for (var i = 0; i < memories.length; i++) {
        var m = memories[i];
        html += '<div class="memory-item" style="position:relative;">';
        html += '<button class="delete-btn" onclick="event.stopPropagation(); deleteMemory(' + m.id + ')" title="Delete memory" style="position:absolute;top:0;right:0;">‚úï</button>';
        html += '<div class="memory-date">' + m.date + '</div>';
        html += '<div class="memory-content"><div class="memory-title">' + m.title + '</div>';
        html += '<div class="memory-text">' + m.text + '</div>';
        if (m.hasPhotos) {
          html += '<div class="memory-photos"><div class="memory-photo">üì∑</div><div class="memory-photo">üì∑</div></div>';
        }
        html += '</div></div>';
      }
      if (!html) html = '<div style="padding:2rem;text-align:center;color:#6b7280;">No memories yet</div>';
      container.innerHTML = html;
    }

    // =====================================================
    // RENDER: TASKS
    // =====================================================
    function renderTasks(category) {
      var allTasks = Store.get('tasks') || { family: [], school: [], sport: [] };
      var categories = category ? [category] : ['family', 'school', 'sport'];
      for (var c = 0; c < categories.length; c++) {
        var cat = categories[c];
        var container = document.getElementById('taskList-' + cat);
        if (!container) continue;
        var tasks = allTasks[cat] || [];
        var html = '';
        for (var i = 0; i < tasks.length; i++) {
          var t = tasks[i];
          html += '<div class="task-item' + (t.completed ? ' completed' : '') + '" onclick="toggleTask(' + t.id + ', \'' + cat + '\')">';
          html += '<div class="task-checkbox">' + (t.completed ? '‚úì' : '') + '</div>';
          html += '<div class="task-text" style="flex:1;">' + t.text + '</div>';
          html += '<button class="delete-btn" onclick="event.stopPropagation(); deleteTask(' + t.id + ', \'' + cat + '\')" title="Delete task">‚úï</button>';
          html += '</div>';
        }
        if (!html) html = '<div style="padding:2rem;text-align:center;color:#6b7280;">No tasks yet</div>';
        container.innerHTML = html;
      }
    }

    // =====================================================
    // FORM HANDLERS
    // =====================================================
    function addEvent(e) {
      e.preventDefault();
      var form = e.target;
      var inputs = form.querySelectorAll('input, select, textarea');
      var title = inputs[0].value;
      var date = inputs[1].value;
      var time = inputs[2].value;
      var location = inputs[3].value;
      var recurring = inputs[4].checked ? form.querySelectorAll('select')[1].value : false;
      var category = form.querySelectorAll('select')[recurring ? 2 : 1].value;
      var events = Store.get('events') || [];
      var newEvent = {
        id: Store.getNextId('events'),
        title: getCategoryIcon(category) + ' ' + title,
        date: date,
        time: time || '',
        category: category,
        recurring: recurring,
        location: location || ''
      };
      events.push(newEvent);
      Store.set('events', events);
      renderCalendar();
      renderUpcomingEvents();
      alert('Event added to Family Calendar!');
      form.reset();
      closeModal('eventModal');
    }

    function addHealthRecord(e) {
      e.preventDefault();
      var form = e.target;
      var selects = form.querySelectorAll('select');
      var inputs = form.querySelectorAll('input');
      var textareas = form.querySelectorAll('textarea');
      var person = selects[0].value;
      var personName = selects[0].options[selects[0].selectedIndex].text;
      var date = inputs[0].value;
      var detail = textareas[0].value;
      var records = Store.get('health') || [];
      var dateFormatted = new Date(date).toLocaleDateString('en-AU', { day: '2-digit', month: '2-digit', year: 'numeric' });
      records.unshift({
        id: Store.getNextId('health'),
        person: person,
        name: personName,
        date: dateFormatted,
        detail: detail,
        attachments: []
      });
      Store.set('health', records);
      renderHealthRecords();
      alert('Health record added!');
      form.reset();
      closeModal('healthModal');
    }

    function addPhoto(e) {
      e.preventDefault();
      var form = e.target;
      var inputs = form.querySelectorAll('input');
      var date = inputs[1].value;
      var description = inputs[2].value || 'New Photo';
      var d = new Date(date);
      var monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      var photos = Store.get('photos') || [];
      photos.unshift({
        id: Store.getNextId('photos'),
        title: description,
        date: monthNames[d.getMonth()] + ' ' + d.getDate(),
        year: String(d.getFullYear())
      });
      Store.set('photos', photos);
      renderPhotos();
      alert('Photo added!');
      form.reset();
      closeModal('photoModal');
    }

    function addMemory(e) {
      e.preventDefault();
      var form = e.target;
      var inputs = form.querySelectorAll('input');
      var textareas = form.querySelectorAll('textarea');
      var date = inputs[0].value;
      var title = inputs[1].value;
      var text = textareas[0].value;
      var hasPhotos = form.querySelectorAll('input[type="file"]')[0].files.length > 0;
      var d = new Date(date);
      var monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      var memories = Store.get('memories') || [];
      memories.unshift({
        id: Store.getNextId('memories'),
        date: monthNames[d.getMonth()] + ' ' + d.getFullYear(),
        title: title,
        text: text,
        hasPhotos: hasPhotos
      });
      Store.set('memories', memories);
      renderMemories();
      alert('Memory added!');
      form.reset();
      closeModal('memoryModal');
    }

    function addTrip(e) {
      e.preventDefault();
      var form = e.target;
      var inputs = form.querySelectorAll('input');
      var name = inputs[0].value;
      var dest = inputs[1].value;
      var startDate = inputs[2].value;
      var endDate = inputs[3].value;
      // Add to sidebar
      var tripList = document.querySelector('.trip-list');
      if (tripList) {
        var item = document.createElement('div');
        item.className = 'trip-item';
        item.onclick = function(ev) { showTrip('custom', ev); };
        var s = new Date(startDate);
        var ed = new Date(endDate);
        var monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        var days = Math.ceil((ed - s) / (1000 * 60 * 60 * 24)) + 1;
        item.innerHTML = '<div class="trip-item-name">' + name + '</div><div class="trip-item-dates">' + monthNames[s.getMonth()] + ' ' + s.getDate() + '-' + ed.getDate() + ', ' + s.getFullYear() + ' &bull; ' + days + ' days</div>';
        tripList.appendChild(item);
      }
      alert('Trip created!');
      form.reset();
      closeModal('tripModal');
    }

    function addSportEntry(e) {
      e.preventDefault();
      var participant = document.getElementById('sportParticipant');
      var sport = document.getElementById('sportSport');
      var entryType = document.getElementById('sportType');
      var startDate = document.getElementById('sportStartDate');
      var startTime = document.getElementById('sportStartTime');
      var endDate = document.getElementById('sportEndDate');
      var endTime = document.getElementById('sportEndTime');
      var title = document.getElementById('sportTitle');
      var location = document.getElementById('sportLocation');
      var addToCal = document.getElementById('sportAddToCalendar');
      var notes = document.getElementById('sportNotes');
      var matchResultEl = document.querySelector('#matchResult input');

      var sportIcons = { soccer: '‚öΩ', futsal: '‚öΩ', basketball: 'üèÄ', rowing: 'üö£', 'table-tennis': 'üèì', golf: '‚õ≥' };
      var sportIcon = sportIcons[sport.value] || 'üèÖ';
      var participantName = participant.options[participant.selectedIndex].text;
      var sportName = sport.options[sport.selectedIndex].text;
      var entryTitle = title.value || (participantName + ' - ' + sportName + ' ' + entryType.options[entryType.selectedIndex].text);
      var timeRange = startTime.value + (endTime.value ? ' - ' + endTime.value : '');

      // Save sport entry
      var entries = Store.get('sport_entries') || [];
      entries.unshift({
        id: Store.getNextId('sport_entries'),
        title: entryTitle,
        date: startDate.value,
        time: timeRange,
        type: entryType.value,
        participant: participantName,
        sport: sport.value,
        notes: notes.value || '',
        result: matchResultEl ? matchResultEl.value : ''
      });
      Store.set('sport_entries', entries);
      renderSportEntries();

      // Add to calendar if checked
      if (addToCal && addToCal.checked) {
        var events = Store.get('events') || [];
        events.push({
          id: Store.getNextId('events'),
          title: sportIcon + ' ' + entryTitle,
          date: startDate.value,
          time: timeRange,
          category: 'sport',
          recurring: false,
          location: location.value || '',
          participant: participantName,
          sport: sportName
        });
        Store.set('events', events);
        renderCalendar();
        renderUpcomingEvents();
      }

      alert('Sport entry added!' + (addToCal.checked ? ' Also added to Family Calendar.' : ''));
      e.target.reset();
      document.getElementById('sportAddToCalendar').checked = true;
      document.getElementById('matchResult').style.display = 'none';
      closeModal('sportModal');
    }

    function addTask(e) {
      e.preventDefault();
      var form = e.target;
      var category = document.getElementById('taskCategory').value;
      var text = form.querySelectorAll('input[type="text"]')[0].value;
      var allTasks = Store.get('tasks') || { family: [], school: [], sport: [] };
      if (!allTasks[category]) allTasks[category] = [];
      var maxId = 0;
      for (var i = 0; i < allTasks[category].length; i++) {
        if (allTasks[category][i].id > maxId) maxId = allTasks[category][i].id;
      }
      allTasks[category].unshift({ id: maxId + 1, text: text, completed: false });
      Store.set('tasks', allTasks);
      renderTasks(category);
      alert('Task added to ' + category + '!');
      form.reset();
      closeModal('taskModal');
    }

    // =====================================================
    // TOGGLE & DELETE HANDLERS
    // =====================================================
    function toggleTask(id, category) {
      var allTasks = Store.get('tasks') || { family: [], school: [], sport: [] };
      var tasks = allTasks[category] || [];
      for (var i = 0; i < tasks.length; i++) {
        if (tasks[i].id === id) {
          tasks[i].completed = !tasks[i].completed;
          break;
        }
      }
      allTasks[category] = tasks;
      Store.set('tasks', allTasks);
      renderTasks(category);
    }

    function deleteEvent(id) {
      if (!confirm('Delete this event?')) return;
      var events = Store.get('events') || [];
      events = events.filter(function(e) { return e.id !== id; });
      Store.set('events', events);
      renderCalendar();
      renderUpcomingEvents();
    }

    function deleteTask(id, category) {
      var allTasks = Store.get('tasks') || { family: [], school: [], sport: [] };
      allTasks[category] = (allTasks[category] || []).filter(function(t) { return t.id !== id; });
      Store.set('tasks', allTasks);
      renderTasks(category);
    }

    function deleteHealthRecord(id) {
      if (!confirm('Delete this health record?')) return;
      var records = Store.get('health') || [];
      records = records.filter(function(r) { return r.id !== id; });
      Store.set('health', records);
      renderHealthRecords();
    }

    function deleteSportEntry(id) {
      if (!confirm('Delete this sport entry?')) return;
      var entries = Store.get('sport_entries') || [];
      entries = entries.filter(function(e) { return e.id !== id; });
      Store.set('sport_entries', entries);
      renderSportEntries();
    }

    function deleteMemory(id) {
      if (!confirm('Delete this memory?')) return;
      var memories = Store.get('memories') || [];
      memories = memories.filter(function(m) { return m.id !== id; });
      Store.set('memories', memories);
      renderMemories();
    }

    // =====================================================
    // EXISTING UI FUNCTIONS
    // =====================================================
    function toggleSportFields() {
      var sportType = document.getElementById('sportType').value;
      document.getElementById('matchResult').style.display = (sportType === 'match') ? 'block' : 'none';
    }

    function showTrip(tripId, e) {
      var items = document.querySelectorAll('.trip-item');
      for (var i = 0; i < items.length; i++) items[i].classList.remove('active');
      var evt = e || window.event;
      if (evt && evt.currentTarget) evt.currentTarget.classList.add('active');
    }

    function showTripTab(tabName, e) {
      var tabs = document.querySelectorAll('.trip-tab');
      for (var i = 0; i < tabs.length; i++) tabs[i].classList.remove('active');
      var contents = document.querySelectorAll('.trip-tab-content');
      for (var i = 0; i < contents.length; i++) contents[i].classList.remove('active');
      var evt = e || window.event;
      if (evt && evt.currentTarget) evt.currentTarget.classList.add('active');
      var tabEl = document.getElementById('trip-' + tabName);
      if (tabEl) tabEl.classList.add('active');
    }

    function showTaskTab(tabName) {
      var tabs = document.querySelectorAll('.task-tab');
      for (var i = 0; i < tabs.length; i++) tabs[i].classList.remove('active');
      var contents = document.querySelectorAll('.task-content');
      for (var i = 0; i < contents.length; i++) contents[i].classList.remove('active');
      event.currentTarget.classList.add('active');
      document.getElementById('task-' + tabName).classList.add('active');
      renderTasks(tabName);
    }

    function filterTimeline(category) {
      var items = document.querySelectorAll('.timeline-item');
      for (var i = 0; i < items.length; i++) {
        items[i].style.display = (category === 'all' || items[i].dataset.category === category) ? '' : 'none';
      }
    }

    // =====================================================
    // INITIALIZATION
    // =====================================================
    function renderAll() {
      renderCalendar();
      renderUpcomingEvents();
      renderHealthRecords();
      renderSportEntries();
      renderPhotos();
      renderMemories();
      renderTasks();
    }

    document.addEventListener('DOMContentLoaded', function() {
      // Recurring checkbox toggle
      var recurringCheckbox = document.getElementById('recurringEvent');
      var recurringOptions = document.getElementById('recurringOptions');
      if (recurringCheckbox) {
        recurringCheckbox.addEventListener('change', function() {
          recurringOptions.style.display = this.checked ? 'block' : 'none';
        });
      }

      // Check auth
      checkAuth();

      // Seed data then start listeners and render
      seedDefaultData(function() {
        Store.initListeners();
        Store._ready = true;
        renderAll();
      });
    });
  </script>
</body>
</html>
